(this.dmpJsonp=this.dmpJsonp||[]).push([["vendors~hlsjs_beta"],{RHIG:function(e,t){"undefined"!=typeof window&&function r(i,a){"object"==typeof t&&"object"==typeof e?e.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof t?t.Hls=a():i.Hls=a()}(this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(i,a,function(t){return e[t]}.bind(null,a));return i},t.n=function(e){var r=e&&e.__esModule?function t(){return e.default}:function t(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
  !*** ./node_modules/eventemitter3/index.js ***!
  \*********************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,r){"use strict";function i(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function n(e,t,r,i,n){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new a(r,i||e,n),o=d?d+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],s]:e._events[o].push(s):(e._events[o]=s,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}var l=Object.prototype.hasOwnProperty,d="~";Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(d=!1)),o.prototype.eventNames=function e(){var t=[],r,i;if(0===this._eventsCount)return t;for(i in r=this._events)l.call(r,i)&&t.push(d?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(r)):t},o.prototype.listeners=function e(t){var r=d?d+t:t,i=this._events[r];if(!i)return[];if(i.fn)return[i.fn];for(var a=0,n=i.length,s=new Array(n);a<n;a++)s[a]=i[a].fn;return s},o.prototype.listenerCount=function e(t){var r=d?d+t:t,i=this._events[r];return i?i.fn?1:i.length:0},o.prototype.emit=function e(t,r,i,a,n,s){var o=d?d+t:t;if(!this._events[o])return!1;var l=this._events[o],u=arguments.length,f,c;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,r),!0;case 3:return l.fn.call(l.context,r,i),!0;case 4:return l.fn.call(l.context,r,i,a),!0;case 5:return l.fn.call(l.context,r,i,a,n),!0;case 6:return l.fn.call(l.context,r,i,a,n,s),!0}for(c=1,f=new Array(u-1);c<u;c++)f[c-1]=arguments[c];l.fn.apply(l.context,f)}else{var h=l.length,g;for(c=0;c<h;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),u){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,r);break;case 3:l[c].fn.call(l[c].context,r,i);break;case 4:l[c].fn.call(l[c].context,r,i,a);break;default:if(!f)for(g=1,f=new Array(u-1);g<u;g++)f[g-1]=arguments[g];l[c].fn.apply(l[c].context,f)}}return!0},o.prototype.on=function e(t,r,i){return n(this,t,r,i,!1)},o.prototype.once=function e(t,r,i){return n(this,t,r,i,!0)},o.prototype.removeListener=function e(t,r,i,a){var n=d?d+t:t;if(!this._events[n])return this;if(!r)return s(this,n),this;var o=this._events[n];if(o.fn)o.fn!==r||a&&!o.once||i&&o.context!==i||s(this,n);else{for(var l=0,u=[],f=o.length;l<f;l++)(o[l].fn!==r||a&&!o[l].once||i&&o[l].context!==i)&&u.push(o[l]);u.length?this._events[n]=1===u.length?u[0]:u:s(this,n)}return this},o.prototype.removeAllListeners=function e(t){var r;return t?(r=d?d+t:t,this._events[r]&&s(this,r)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=d,o.EventEmitter=o,e.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,r){var i,a,n,s,o,l;i=this,a=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/?#]*)(.*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,l={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),t=t.trim(),!t){if(!r.alwaysNormalize)return e;var i=l.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=l.normalizePath(i.path),l.buildURLFromParts(i)}var a=l.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=l.normalizePath(a.path),l.buildURLFromParts(a)):t;var s=l.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var o=n.exec(s.path);s.netLoc=o[1],s.path=o[2]}s.netLoc&&!s.path&&(s.path="/");var d={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(d.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var u=s.path,f=u.substring(0,u.lastIndexOf("/")+1)+a.path;d.path=l.normalizePath(f)}else d.path=s.path,a.params||(d.params=s.params,a.query||(d.query=s.query));return null===d.path&&(d.path=r.alwaysNormalize?l.normalizePath(a.path):a.path),l.buildURLFromParts(d)},parseURL:function(e){var t=a.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(s,"");e.length!==(e=e.replace(o,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=l},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,r){function i(e){function t(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var r=e&&e.__esModule?function t(){return e.default}:function t(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t.oe=function(e){throw console.error(e),e};var i=t(t.s=ENTRY_MODULE);return i.default||i}function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function n(e){return!isNaN(1*e)}function s(e,t,i){var s={};s[i]=[];var o=t.toString(),l=o.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return s;for(var f=l[1],c=new RegExp("(\\\\n|\\W)"+a(f)+u,"g"),h;h=c.exec(o);)"dll-reference"!==h[3]&&s[i].push(h[3]);for(c=new RegExp("\\("+a(f)+'\\("(dll-reference\\s('+d+'))"\\)\\)'+u,"g");h=c.exec(o);)e[h[2]]||(s[i].push(h[1]),e[h[2]]=r(h[1]).m),s[h[2]]=s[h[2]]||[],s[h[2]].push(h[4]);for(var g=Object.keys(s),v=0;v<g.length;v++)for(var p=0;p<s[g[v]].length;p++)n(s[g[v]][p])&&(s[g[v]][p]=1*s[g[v]][p]);return s}function o(e){var t=Object.keys(e);return t.reduce(function(t,r){return t||e[r].length>0},!1)}function l(e,t){for(var r={main:[t]},i={main:[]},a={main:{}};o(r);)for(var n=Object.keys(r),l=0;l<n.length;l++){var d=n[l],u=r[d],f=u.pop();if(a[d]=a[d]||{},!a[d][f]&&e[d][f]){a[d][f]=!0,i[d]=i[d]||[],i[d].push(f);for(var c=s(e,e[d][f],d),h=Object.keys(c),g=0;g<h.length;g++)r[h[g]]=r[h[g]]||[],r[h[g]]=r[h[g]].concat(c[h[g]])}}return i}var d="[\\.|\\-|\\+|\\w|/|@]+",u="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+d+").*?\\)";e.exports=function(e,t){t=t||{};var a={main:r.m},n=t.all?{main:Object.keys(a.main)}:l(a,e),s="";Object.keys(n).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;n[e][t];)t++;n[e].push(t),a[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n[e].map(function(t){return JSON.stringify(t)+": "+a[e][t].toString()}).join(",")+"});\n"}),s=s+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map(function(e){return JSON.stringify(e)+": "+a.main[e].toString()}).join(",")+"}))(self);";var o=new window.Blob([s],{type:"text/javascript"});if(t.bare)return o;var d=window.URL||window.webkitURL||window.mozURL||window.msURL,u=d.createObjectURL(o),f=new window.Worker(u);return f.objectURL=u,f}},"./src/demux/demuxer-inline.js":
/*!**************************************************!*\
  !*** ./src/demux/demuxer-inline.js + 16 modules ***!
  \**************************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number-isFinite.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.ts */function(e,t,r){"use strict";function i(e){var t=e.byteLength,r=t&&new DataView(e).getUint8(t-1);return r?e.slice(0,t-r):e}function a(e,t,r,i){var a,n,s,o,l,d=navigator.userAgent.toLowerCase(),u=i,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(a=1+((192&t[r+2])>>>6),n=(60&t[r+2])>>>2,!(n>f.length-1))return o=(1&t[r+2])<<2,o|=(192&t[r+3])>>>6,R.logger.log("manifest codec:"+i+",ADTS data:type:"+a+",sampleingIndex:"+n+"["+f[n]+"Hz],channelConfig:"+o),/firefox/i.test(d)?n>=6?(a=5,l=new Array(4),s=n-3):(a=2,l=new Array(2),s=n):-1!==d.indexOf("android")?(a=2,l=new Array(2),s=n):(a=5,l=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&n>=6?s=n-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(n>=6&&1===o||/vivaldi/i.test(d))||!i&&1===o)&&(a=2,l=new Array(2)),s=n)),l[0]=a<<3,l[0]|=(14&n)>>1,l[1]|=(1&n)<<7,l[1]|=o<<3,5===a&&(l[1]|=(14&s)>>1,l[2]=(1&s)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:f[n],channelCount:o,codec:"mp4a.40."+a,manifestCodec:u};e.trigger(y.default.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+n})}function n(e,t){return 255===e[t]&&240==(246&e[t+1])}function s(e,t){return 1&e[t+1]?7:9}function o(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function l(e,t){return!!(t+1<e.length&&n(e,t))}function d(e,t){if(l(e,t)){var r=s(e,t),i=r;t+5<e.length&&(i=o(e,t));var a=t+i;if(a===e.length||a+1<e.length&&n(e,a))return!0}return!1}function u(e,t,r,i,n){if(!e.samplerate){var s=a(t,r,i,n);e.config=s.config,e.samplerate=s.samplerate,e.channelCount=s.channelCount,e.codec=s.codec,e.manifestCodec=s.manifestCodec,R.logger.log("parsed codec:"+e.codec+",rate:"+s.samplerate+",nb channel:"+s.channelCount)}}function f(e){return 9216e4/e}function c(e,t,r,i,a){var n,l,d,u=e.length;if(n=s(e,t),l=o(e,t),l-=n,l>0&&t+n+l<=u)return d=r+i*a,{headerLength:n,frameLength:l,stamp:d}}function h(e,t,r,i,a){var n=f(e.samplerate),s=c(t,r,i,a,n);if(s){var o=s.stamp,l=s.headerLength,d=s.frameLength,u={unit:t.subarray(r+l,r+l+d),pts:o,dts:o};return e.samples.push(u),{sample:u,length:d+l}}}function g(e,t,r,i){return void 0===r&&(r=1),void 0===i&&(i=!1),v(e,t,1/r)}function v(e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);var a=e*t*r;return i?Math.round(a):a}function p(e,t){return void 0===t&&(t=!1),v(e,1e3,1/J,t)}function m(e,t){return void 0===t&&(t=1),v(e,J,1/t)}r.r(t);var y=r("./src/events.js"),E=r("./src/errors.ts"),b=function(){function e(e,t){this.subtle=e,this.aesIV=t}var t=e.prototype;return t.decrypt=function e(t,r){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},r,t)},e}(),T=function(){function e(e,t){this.subtle=e,this.key=t}var t=e.prototype;return t.expandKey=function e(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}(),S=T,A=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function e(t){for(var r=new DataView(t),i=new Uint32Array(4),a=0;a<4;a++)i[a]=r.getUint32(4*a);return i},t.initTable=function e(){var t=this.sBox,r=this.invSBox,i=this.subMix,a=i[0],n=i[1],s=i[2],o=i[3],l=this.invSubMix,d=l[0],u=l[1],f=l[2],c=l[3],h=new Uint32Array(256),g=0,v=0,p=0;for(p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var m=v^v<<1^v<<2^v<<3^v<<4;m=m>>>8^255&m^99,t[g]=m,r[m]=g;var y=h[g],E=h[y],b=h[E],T=257*h[m]^16843008*m;a[g]=T<<24|T>>>8,n[g]=T<<16|T>>>16,s[g]=T<<8|T>>>24,o[g]=T,T=16843009*b^65537*E^257*y^16843008*g,d[m]=T<<24|T>>>8,u[m]=T<<16|T>>>16,f[m]=T<<8|T>>>24,c[m]=T,g?(g=y^h[h[h[b^y]]],v^=h[h[v]]):g=v=1}},t.expandKey=function e(t){for(var r=this.uint8ArrayToUint32Array_(t),i=!0,a=0;a<r.length&&i;)i=r[a]===this.key[a],a++;if(!i){this.key=r;var n=this.keySize=r.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var s=this.ksRows=4*(n+6+1),o,l,d=this.keySchedule=new Uint32Array(s),u=this.invKeySchedule=new Uint32Array(s),f=this.sBox,c=this.rcon,h=this.invSubMix,g=h[0],v=h[1],p=h[2],m=h[3],y,E;for(o=0;o<s;o++)o<n?y=d[o]=r[o]:(E=y,o%n==0?(E=E<<8|E>>>24,E=f[E>>>24]<<24|f[E>>>16&255]<<16|f[E>>>8&255]<<8|f[255&E],E^=c[o/n|0]<<24):n>6&&o%n==4&&(E=f[E>>>24]<<24|f[E>>>16&255]<<16|f[E>>>8&255]<<8|f[255&E]),d[o]=y=(d[o-n]^E)>>>0);for(l=0;l<s;l++)o=s-l,E=3&l?d[o]:d[o-4],u[l]=l<4||o<=4?E:g[f[E>>>24]]^v[f[E>>>16&255]]^p[f[E>>>8&255]]^m[f[255&E]],u[l]=u[l]>>>0}},t.networkToHostOrderSwap=function e(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},t.decrypt=function e(t,r,a,n){for(var s=this.keySize+6,o=this.invKeySchedule,l=this.invSBox,d=this.invSubMix,u=d[0],f=d[1],c=d[2],h=d[3],g=this.uint8ArrayToUint32Array_(a),v=g[0],p=g[1],m=g[2],y=g[3],E=new Int32Array(t),b=new Int32Array(E.length),T,S,A,_,R,L,D,w,k,I,O,x,P,C,F=this.networkToHostOrderSwap;r<E.length;){for(k=F(E[r]),I=F(E[r+1]),O=F(E[r+2]),x=F(E[r+3]),R=k^o[0],L=x^o[1],D=O^o[2],w=I^o[3],P=4,C=1;C<s;C++)T=u[R>>>24]^f[L>>16&255]^c[D>>8&255]^h[255&w]^o[P],S=u[L>>>24]^f[D>>16&255]^c[w>>8&255]^h[255&R]^o[P+1],A=u[D>>>24]^f[w>>16&255]^c[R>>8&255]^h[255&L]^o[P+2],_=u[w>>>24]^f[R>>16&255]^c[L>>8&255]^h[255&D]^o[P+3],R=T,L=S,D=A,w=_,P+=4;T=l[R>>>24]<<24^l[L>>16&255]<<16^l[D>>8&255]<<8^l[255&w]^o[P],S=l[L>>>24]<<24^l[D>>16&255]<<16^l[w>>8&255]<<8^l[255&R]^o[P+1],A=l[D>>>24]<<24^l[w>>16&255]<<16^l[R>>8&255]<<8^l[255&L]^o[P+2],_=l[w>>>24]<<24^l[R>>16&255]<<16^l[L>>8&255]<<8^l[255&D]^o[P+3],P+=3,b[r]=F(T^v),b[r+1]=F(_^p),b[r+2]=F(A^m),b[r+3]=F(S^y),v=k,p=I,m=O,y=x,r+=4}return n?i(b.buffer):b.buffer},t.destroy=function e(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),_=A,R=r("./src/utils/logger.js"),L=r("./src/utils/get-self-scope.js"),D=Object(L.getSelfScope)(),w=function(){function e(e,t,r){var i=void 0===r?{}:r,a=i.removePKCS7Padding,n=void 0===a||a;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=n,n)try{var s=D.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(o){}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function e(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function e(t,r,i,a){var n=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(R.logger.log("JS AES decrypt"),this.logEnabled=!1);var s=this.decryptor;s||(this.decryptor=s=new _),s.expandKey(r),a(s.decrypt(t,0,i,this.removePKCS7Padding))}else{this.logEnabled&&(R.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var o=this.subtle;this.key!==r&&(this.key=r,this.fastAesKey=new S(o,r)),this.fastAesKey.expandKey().then(function(e){var s=new b(o,i);s.decrypt(t,e).catch(function(e){n.onWebCryptoError(e,t,r,i,a)}).then(function(e){a(e)})}).catch(function(e){n.onWebCryptoError(e,t,r,i,a)})}},t.onWebCryptoError=function e(t,r,i,a,n){this.config.enableSoftwareAES?(R.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(r,i,a,n)):(R.logger.error("decrypting error : "+t.message),this.observer.trigger(y.default.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},t.destroy=function e(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},e}(),k=w,I=r("./src/polyfills/number-isFinite.js"),O=r("./src/demux/id3.js"),x=function(){function e(e,t,r){this.observer=e,this.config=r,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function e(t,r,i,a){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:r,duration:a,inputTimeScale:9e4}},t.resetTimeStamp=function e(){},e.probe=function e(t){if(!t)return!1;for(var r=O.default.getID3Data(t,0)||[],i=r.length,a=t.length;i<a;i++)if(d(t,i))return R.logger.log("ADTS sync word found !"),!0;return!1},t.append=function e(t,r,i,a){for(var n=this._audioTrack,s=O.default.getID3Data(t,0)||[],o=O.default.getTimeStamp(s),d=Object(I.isFiniteNumber)(o)?90*o:9e4*r,f=0,c=d,g=t.length,v=s.length,p=[{pts:c,dts:c,data:s}];v<g-1;)if(l(t,v)&&v+5<g){u(n,this.observer,t,v,n.manifestCodec);var m=h(n,t,v,d,f);if(!m){R.logger.log("Unable to parse AAC frame");break}v+=m.length,c=m.sample.pts,f++}else O.default.isHeader(t,v)?(s=O.default.getID3Data(t,v),p.push({pts:c,dts:c,data:s}),v+=s.length):v++;this.remuxer.remux(n,{samples:[]},{samples:p,inputTimeScale:9e4},{samples:[]},r,i,a)},t.destroy=function e(){},e}(),P=x,C=r("./src/demux/mp4demuxer.js"),F={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function e(t,r,i,a,n){if(!(i+24>r.length)){var s=this.parseHeader(r,i);if(s&&i+s.frameLength<=r.length){var o=9e4*s.samplesPerFrame/s.sampleRate,l=a+n*o,d={unit:r.subarray(i,i+s.frameLength),pts:l,dts:l};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(d),{sample:d,length:s.frameLength}}}},parseHeader:function e(t,r){var i=t[r+1]>>3&3,a=t[r+1]>>1&3,n=t[r+2]>>4&15,s=t[r+2]>>2&3,o=t[r+2]>>1&1;if(1!==i&&0!==n&&15!==n&&3!==s){var l=3===i?3-a:3===a?3:4,d=1e3*F.BitratesMap[14*l+n-1],u=3===i?0:2===i?1:2,f=F.SamplingRateMap[3*u+s],c=t[r+3]>>6==3?1:2,h=F.SamplesCoefficients[i][a],g=F.BytesInSlot[a],v=8*h*g,p=parseInt(h*d/f+o,10)*g;return{sampleRate:f,channelCount:c,frameLength:p,samplesPerFrame:v}}},isHeaderPattern:function e(t,r){return 255===t[r]&&224==(224&t[r+1])&&0!=(6&t[r+1])},isHeader:function e(t,r){return!!(r+1<t.length&&this.isHeaderPattern(t,r))},probe:function e(t,r){if(r+1<t.length&&this.isHeaderPattern(t,r)){var i=4,a=this.parseHeader(t,r),n=4;a&&a.frameLength&&(n=a.frameLength);var s=r+n;if(s===t.length||s+1<t.length&&this.isHeaderPattern(t,s))return!0}return!1}},M=F,N=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function e(){var t=this.data,r=this.bytesAvailable,i=t.byteLength-r,a=new Uint8Array(4),n=Math.min(4,r);if(0===n)throw new Error("no bytes available");a.set(t.subarray(i,i+n)),this.word=new DataView(a.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},t.skipBits=function e(t){var r;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,r=t>>3,t-=r>>3,this.bytesAvailable-=r,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},t.readBits=function e(t){var r=Math.min(this.bitsAvailable,t),i=this.word>>>32-r;return t>32&&R.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=r,this.bitsAvailable>0?this.word<<=r:this.bytesAvailable>0&&this.loadWord(),r=t-r,r>0&&this.bitsAvailable?i<<r|this.readBits(r):i},t.skipLZ=function e(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.skipUEG=function e(){this.skipBits(1+this.skipLZ())},t.skipEG=function e(){this.skipBits(1+this.skipLZ())},t.readUEG=function e(){var t=this.skipLZ();return this.readBits(t+1)-1},t.readEG=function e(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.readBoolean=function e(){return 1===this.readBits(1)},t.readUByte=function e(){return this.readBits(8)},t.readUShort=function e(){return this.readBits(16)},t.readUInt=function e(){return this.readBits(32)},t.skipScalingList=function e(t){var r=8,i=8,a,n;for(a=0;a<t;a++)0!==i&&(n=this.readEG(),i=(r+n+256)%256),r=0===i?r:i},t.readSPS=function e(){var t=0,r=0,i=0,a=0,n,s,o,l,d,u,f,c,h,g=this.readUByte.bind(this),v=this.readBits.bind(this),p=this.readUEG.bind(this),m=this.readBoolean.bind(this),y=this.skipBits.bind(this),E=this.skipEG.bind(this),b=this.skipUEG.bind(this),T=this.skipScalingList.bind(this);if(g(),n=g(),s=v(5),y(3),o=g(),b(),100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n){var S=p();if(3===S&&y(1),b(),b(),y(1),m())for(c=3!==S?8:12,h=0;h<c;h++)m()&&T(h<6?16:64)}b();var A=p();if(0===A)p();else if(1===A)for(y(1),E(),E(),l=p(),h=0;h<l;h++)E();b(),y(1),d=p(),u=p(),f=v(1),0===f&&y(1),y(1),m()&&(t=p(),r=p(),i=p(),a=p());var _=[1,1];if(m()&&m()){var R=g();switch(R){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[g()<<8|g(),g()<<8|g()]}}return{width:Math.ceil(16*(d+1)-2*t-2*r),height:(2-f)*(u+1)*16-(f?2:4)*(i+a),pixelRatio:_}},t.readSliceType=function e(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),U=N,B=function(){function e(e,t,r,i){this.decryptdata=r,this.discardEPB=i,this.decrypter=new k(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function e(t,r){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,r)},t.decryptAacSample=function e(t,r,i,a){var n=t[r].unit,s=n.subarray(16,n.length-n.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length),l=this;this.decryptBuffer(o,function(e){e=new Uint8Array(e),n.set(e,16),a||l.decryptAacSamples(t,r+1,i)})},t.decryptAacSamples=function e(t,r,i){for(;;r++){if(r>=t.length)return void i();if(!(t[r].unit.length<32)){var a=this.decrypter.isSync();if(this.decryptAacSample(t,r,i,a),!a)return}}},t.getAvcEncryptedData=function e(t){for(var r=16*Math.floor((t.length-48)/160)+16,i=new Int8Array(r),a=0,n=32;n<=t.length-16;n+=160,a+=16)i.set(t.subarray(n,n+16),a);return i},t.getAvcDecryptedUnit=function e(t,r){r=new Uint8Array(r);for(var i=0,a=32;a<=t.length-16;a+=160,i+=16)t.set(r.subarray(i,i+16),a);return t},t.decryptAvcSample=function e(t,r,i,a,n,s){var o=this.discardEPB(n.data),l=this.getAvcEncryptedData(o),d=this;this.decryptBuffer(l.buffer,function(e){n.data=d.getAvcDecryptedUnit(o,e),s||d.decryptAvcSamples(t,r,i+1,a)})},t.decryptAvcSamples=function e(t,r,i,a){for(;;r++,i=0){if(r>=t.length)return void a();for(var n=t[r].units;!(i>=n.length);i++){var s=n[i];if(!(s.length<=48||1!==s.type&&5!==s.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,r,i,a,s,o),!o)return}}}},e}(),G=B,j={video:1,audio:2,id3:3,text:4},K=function(){function e(e,t,r,i){this.observer=e,this.config=r,this.typeSupported=i,this.remuxer=t,this.sampleAes=null}var t=e.prototype;return t.setDecryptData=function e(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new G(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},e.probe=function t(r){var i=e._syncOffset(r);return!(i<0)&&(i&&R.logger.warn("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),!0)},e._syncOffset=function e(t){for(var r=Math.min(1e3,t.length-564),i=0;i<r;){if(71===t[i]&&71===t[i+188]&&71===t[i+376])return i;i++}return-1},e.createTrack=function e(t,r){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:j[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?r:void 0}},t.resetInitSegment=function t(r,i,a,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",n),this._audioTrack=e.createTrack("audio",n),this._id3Track=e.createTrack("id3",n),this._txtTrack=e.createTrack("text",n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=i,this.videoCodec=a,this._duration=n},t.resetTimeStamp=function e(){},t.append=function t(r,i,a,n){var s,o=r.length,l,d,u,f,c,h=!1;this.contiguous=a;var g=this.pmtParsed,v=this._avcTrack,p=this._audioTrack,m=this._id3Track,b=v.pid,T=p.pid,S=m.pid,A=this._pmtId,_=v.pesData,L=p.pesData,D=m.pesData,w=this._parsePAT,k=this._parsePMT,I=this._parsePES,O=this._parseAVCPES.bind(this),x=this._parseAACPES.bind(this),P=this._parseMPEGPES.bind(this),C=this._parseID3PES.bind(this),F=e._syncOffset(r);for(o-=(o+F)%188,s=F;s<o;s+=188)if(71===r[s]){if(l=!!(64&r[s+1]),d=((31&r[s+1])<<8)+r[s+2],u=(48&r[s+3])>>4,u>1){if(f=s+5+r[s+4],f===s+188)continue}else f=s+4;switch(d){case b:l&&(_&&(c=I(_))&&void 0!==c.pts&&O(c,!1),_={data:[],size:0}),_&&(_.data.push(r.subarray(f,s+188)),_.size+=s+188-f);break;case T:l&&(L&&(c=I(L))&&void 0!==c.pts&&(p.isAAC?x(c):P(c)),L={data:[],size:0}),L&&(L.data.push(r.subarray(f,s+188)),L.size+=s+188-f);break;case S:l&&(D&&(c=I(D))&&void 0!==c.pts&&C(c),D={data:[],size:0}),D&&(D.data.push(r.subarray(f,s+188)),D.size+=s+188-f);break;case 0:l&&(f+=r[f]+1),A=this._pmtId=w(r,f);break;case A:l&&(f+=r[f]+1);var M=k(r,f,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);b=M.avc,b>0&&(v.pid=b),T=M.audio,T>0&&(p.pid=T,p.isAAC=M.isAAC),S=M.id3,S>0&&(m.pid=S),h&&!g&&(R.logger.log("reparse from beginning"),h=!1,s=F-188),g=this.pmtParsed=!0;break;case 17:case 8191:break;default:h=!0}}else this.observer.trigger(y.default.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});_&&(c=I(_))&&void 0!==c.pts?(O(c,!0),v.pesData=null):v.pesData=_,L&&(c=I(L))&&void 0!==c.pts?(p.isAAC?x(c):P(c),p.pesData=null):(L&&L.size&&R.logger.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=L),D&&(c=I(D))&&void 0!==c.pts?(C(c),m.pesData=null):m.pesData=D,null==this.sampleAes?this.remuxer.remux(p,v,m,this._txtTrack,i,a,n):this.decryptAndRemux(p,v,m,this._txtTrack,i,a,n)},t.decryptAndRemux=function e(t,r,i,a,n,s,o){if(t.samples&&t.isAAC){var l=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){l.decryptAndRemuxAvc(t,r,i,a,n,s,o)})}else this.decryptAndRemuxAvc(t,r,i,a,n,s,o)},t.decryptAndRemuxAvc=function e(t,r,i,a,n,s,o){if(r.samples){var l=this;this.sampleAes.decryptAvcSamples(r.samples,0,0,function(){l.remuxer.remux(t,r,i,a,n,s,o)})}else this.remuxer.remux(t,r,i,a,n,s,o)},t.destroy=function e(){this._initPTS=this._initDTS=void 0,this._duration=0},t._parsePAT=function e(t,r){return(31&t[r+10])<<8|t[r+11]},t._parsePMT=function e(t,r,i,a){var n,s,o,l,d={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=(15&t[r+1])<<8|t[r+2],s=r+3+n-4,o=(15&t[r+10])<<8|t[r+11],r+=12+o;r<s;){switch(l=(31&t[r+1])<<8|t[r+2],t[r]){case 207:if(!a){R.logger.log("unknown stream type:"+t[r]);break}case 15:-1===d.audio&&(d.audio=l);break;case 21:-1===d.id3&&(d.id3=l);break;case 219:if(!a){R.logger.log("unknown stream type:"+t[r]);break}case 27:-1===d.avc&&(d.avc=l);break;case 3:case 4:i?-1===d.audio&&(d.audio=l,d.isAAC=!1):R.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:R.logger.warn("HEVC stream type found, not supported for now");break;default:R.logger.log("unknown stream type:"+t[r])}r+=5+((15&t[r+3])<<8|t[r+4])}return d},t._parsePES=function e(t){var r=0,i,a,n,s,o,l,d,u,f,c=t.data;if(!t||0===t.size)return null;for(;c[0].length<19&&c.length>1;){var h=new Uint8Array(c[0].length+c[1].length);h.set(c[0]),h.set(c[1],c[0].length),c[0]=h,c.splice(1,1)}if(i=c[0],n=(i[0]<<16)+(i[1]<<8)+i[2],1===n){if(s=(i[4]<<8)+i[5],s&&s>t.size-6)return null;if(a=i[7],192&a&&(d=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2,d>4294967295&&(d-=8589934592),64&a?(u=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2,u>4294967295&&(u-=8589934592),d-u>54e5&&(R.logger.warn(Math.round((d-u)/9e4)+"s delta between PTS and DTS, align them"),d=u)):u=d),o=i[8],f=o+9,t.size<=f)return null;t.size-=f,l=new Uint8Array(t.size);for(var g=0,v=c.length;g<v;g++){i=c[g];var p=i.byteLength;if(f){if(f>p){f-=p;continue}i=i.subarray(f),p-=f,f=0}l.set(i,r),r+=p}return s&&(s-=o+3),{data:l,pts:d,dts:u,len:s}}return null},t.pushAccesUnit=function e(t,r){if(t.units.length&&t.frame){var i=r.samples,a=i.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||r.sps&&(a||this.contiguous)?(t.id=a,i.push(t)):r.dropped++}t.debug.length&&R.logger.log(t.pts+"/"+t.dts+":"+t.debug)},t._parseAVCPES=function e(t,r){var i=this,a=this._avcTrack,n=this._parseAVCNALu(t.data),s=!1,o,l=this.avcSample,d,u=!1,f,c=this.pushAccesUnit.bind(this),h=function e(t,r,i,a){return{key:t,pts:r,dts:i,units:[],debug:a}};t.data=null,l&&n.length&&!a.audFound&&(c(l,a),l=this.avcSample=h(!1,t.pts,t.dts,"")),n.forEach(function(e){switch(e.type){case 1:d=!0,l||(l=i.avcSample=h(!0,t.pts,t.dts,"")),l.frame=!0;var r=e.data;if(u&&r.length>4){var n=new U(r).readSliceType();2!==n&&4!==n&&7!==n&&9!==n||(l.key=!0)}break;case 5:d=!0,l||(l=i.avcSample=h(!0,t.pts,t.dts,"")),l.key=!0,l.frame=!0;break;case 6:d=!0,o=new U(i.discardEPB(e.data)),o.readUByte();for(var s=0,g=0,v=!1,p=0;!v&&o.bytesAvailable>1;){s=0;do{p=o.readUByte(),s+=p}while(255===p);g=0;do{p=o.readUByte(),g+=p}while(255===p);if(4===s&&0!==o.bytesAvailable){v=!0;var m=o.readUByte();if(181===m){var y=o.readUShort();if(49===y){var E=o.readUInt();if(1195456820===E){var b=o.readUByte();if(3===b){var T=o.readUByte(),S=o.readUByte(),A=31&T,_=[T,S];for(f=0;f<A;f++)_.push(o.readUByte()),_.push(o.readUByte()),_.push(o.readUByte());i._insertSampleInOrder(i._txtTrack.samples,{type:3,pts:t.pts,bytes:_})}}}}}else if(5===s&&0!==o.bytesAvailable){if(v=!0,g>16){var R=[];for(f=0;f<16;f++)R.push(o.readUByte().toString(16)),3!==f&&5!==f&&7!==f&&9!==f||R.push("-");var L=g-16,D=new Uint8Array(L);for(f=0;f<L;f++)D[f]=o.readUByte();i._insertSampleInOrder(i._txtTrack.samples,{pts:t.pts,payloadType:s,uuid:R.join(""),userDataBytes:D,userData:Object(O.utf8ArrayToStr)(D.buffer)})}}else if(g<o.bytesAvailable)for(f=0;f<g;f++)o.readUByte()}break;case 7:if(d=!0,u=!0,!a.sps){o=new U(e.data);var w=o.readSPS();a.width=w.width,a.height=w.height,a.pixelRatio=w.pixelRatio,a.sps=[e.data],a.duration=i._duration;var k=e.data.subarray(1,4),I="avc1.";for(f=0;f<3;f++){var x=k[f].toString(16);x.length<2&&(x="0"+x),I+=x}a.codec=I}break;case 8:d=!0,a.pps||(a.pps=[e.data]);break;case 9:d=!1,a.audFound=!0,l&&c(l,a),l=i.avcSample=h(!1,t.pts,t.dts,"");break;case 12:d=!1;break;default:d=!1,l&&(l.debug+="unknown NAL "+e.type+" ")}if(l&&d){var P=l.units;P.push(e)}}),r&&l&&(c(l,a),this.avcSample=null)},t._insertSampleInOrder=function e(t,r){var i=t.length;if(i>0){if(r.pts>=t[i-1].pts)t.push(r);else for(var a=i-1;a>=0;a--)if(r.pts<t[a].pts){t.splice(a,0,r);break}}else t.push(r)},t._getLastNalUnit=function e(){var t=this.avcSample,r;if(!t||0===t.units.length){var i=this._avcTrack,a=i.samples;t=a[a.length-1]}if(t){var n=t.units;r=n[n.length-1]}return r},t._parseAVCNALu=function e(t){var r=0,i=t.byteLength,a,n,s=this._avcTrack,o=s.naluState||0,l=o,d=[],u,f,c=-1,h;for(-1===o&&(c=0,h=31&t[0],o=0,r=1);r<i;)if(a=t[r++],o)if(1!==o)if(a)if(1===a){if(c>=0)u={data:t.subarray(c,r-o-1),type:h},d.push(u);else{var g=this._getLastNalUnit();if(g&&(l&&r<=4-l&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-l)),n=r-o-1,n>0)){var v=new Uint8Array(g.data.byteLength+n);v.set(g.data,0),v.set(t.subarray(0,n),g.data.byteLength),g.data=v}}r<i?(f=31&t[r],c=r,h=f,o=0):o=-1}else o=0;else o=3;else o=a?0:2;else o=a?0:1;if(c>=0&&o>=0&&(u={data:t.subarray(c,i),type:h,state:o},d.push(u)),0===d.length){var p=this._getLastNalUnit();if(p){var m=new Uint8Array(p.data.byteLength+t.byteLength);m.set(p.data,0),m.set(t,p.data.byteLength),p.data=m}}return s.naluState=o,d},t.discardEPB=function e(t){for(var r=t.byteLength,i=[],a=1,n,s;a<r-2;)0===t[a]&&0===t[a+1]&&3===t[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return t;n=r-i.length,s=new Uint8Array(n);var o=0;for(a=0;a<n;o++,a++)o===i[0]&&(o++,i.shift()),s[a]=t[o];return s},t._parseAACPES=function e(t){var r=this._audioTrack,i=t.data,a=t.pts,n=0,s=this.aacOverFlow,o=this.aacLastPTS,d,c,g,v,p,m,b;if(s){var T=new Uint8Array(s.byteLength+i.byteLength);T.set(s,0),T.set(i,s.byteLength),i=T}for(g=0,p=i.length;g<p-1&&!l(i,g);g++);if(g&&(g<p-1?(m="AAC PES did not start with ADTS header,offset:"+g,b=!1):(m="no ADTS header found in AAC PES",b=!0),R.logger.warn("parsing error:"+m),this.observer.trigger(y.default.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,fatal:b,reason:m}),b))return;if(u(r,this.observer,i,g,this.audioCodec),c=0,d=f(r.samplerate),s&&o){var S=o+d;Math.abs(S-a)>1&&(R.logger.log("AAC: align PTS for overlapping frames by "+Math.round((S-a)/90)),a=S)}for(;g<p;)if(l(i,g)&&g+5<p){var A=h(r,i,g,a,c);if(!A)break;g+=A.length,v=A.sample.pts,c++}else g++;s=g<p?i.subarray(g,p):null,this.aacOverFlow=s,this.aacLastPTS=v},t._parseMPEGPES=function e(t){for(var r=t.data,i=r.length,a=0,n=0,s=t.pts;n<i;)if(M.isHeader(r,n)){var o=M.appendFrame(this._audioTrack,r,n,s,a);if(!o)break;n+=o.length,a++}else n++},t._parseID3PES=function e(t){this._id3Track.samples.push(t)},e}(),H=K,V=function(){function e(e,t,r){this.observer=e,this.config=r,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function e(t,r,i,a){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:r,duration:a,inputTimeScale:9e4}},t.resetTimeStamp=function e(){},e.probe=function e(t){var r,i,a=O.default.getID3Data(t,0);if(a&&void 0!==O.default.getTimeStamp(a))for(r=a.length,i=Math.min(t.length-1,r+100);r<i;r++)if(M.probe(t,r))return R.logger.log("MPEG Audio sync word found !"),!0;return!1},t.append=function e(t,r,i,a){for(var n=O.default.getID3Data(t,0),s=O.default.getTimeStamp(n),o=s?90*s:9e4*r,l=n.length,d=t.length,u=0,f=0,c=this._audioTrack,h=[{pts:o,dts:o,data:n}];l<d;)if(M.isHeader(t,l)){var g=M.appendFrame(c,t,l,o,u);if(!g)break;l+=g.length,f=g.sample.pts,u++}else O.default.isHeader(t,l)?(n=O.default.getID3Data(t,l),h.push({pts:f,dts:f,data:n}),l+=n.length):l++;this.remuxer.remux(c,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},r,i,a)},t.destroy=function e(){},e}(),W=V,Y=function(){function e(){}return e.getSilentFrame=function e(t,r){switch(t){case"mp4a.40.2":if(1===r)return new Uint8Array([0,200,0,128,35,128]);if(2===r)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===r)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===r)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===r)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),z=Y,X=Math.pow(2,32)-1,q=function(){function e(){}return e.init=function t(){var r;for(r in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(r)&&(e.types[r]=[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:a};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,d,o,l),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function e(t){for(var r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a,s;a--;)i+=r[a].byteLength;for(s=new Uint8Array(i),s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=255&i,s.set(t,4),a=0,i=8;a<n;a++)s.set(r[a],i),i+=r[a].byteLength;return s},e.hdlr=function t(r){return e.box(e.types.hdlr,e.HDLR_TYPES[r])},e.mdat=function t(r){return e.box(e.types.mdat,r)},e.mdhd=function t(r,i){i*=r;var a=Math.floor(i/(X+1)),n=Math.floor(i%(X+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},e.mdia=function t(r){return e.box(e.types.mdia,e.mdhd(r.timescale,r.duration),e.hdlr(r.type),e.minf(r))},e.mfhd=function t(r){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]))},e.minf=function t(r){return"audio"===r.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(r)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(r))},e.moof=function t(r,i,a){return e.box(e.types.moof,e.mfhd(r),e.traf(a,i))},e.moov=function t(r){for(var i=r.length,a=[];i--;)a[i]=e.trak(r[i]);return e.box.apply(null,[e.types.moov,e.mvhd(r[0].timescale,r[0].duration)].concat(a).concat(e.mvex(r)))},e.mvex=function t(r){for(var i=r.length,a=[];i--;)a[i]=e.trex(r[i]);return e.box.apply(null,[e.types.mvex].concat(a))},e.mvhd=function t(r,i){i*=r;var a=Math.floor(i/(X+1)),n=Math.floor(i%(X+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)},e.sdtp=function t(r){var i=r.samples||[],a=new Uint8Array(4+i.length),n,s;for(s=0;s<i.length;s++)n=i[s].flags,a[s+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function t(r){return e.box(e.types.stbl,e.stsd(r),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function t(r){var i=[],a=[],n,s,o;for(n=0;n<r.sps.length;n++)s=r.sps[n],o=s.byteLength,i.push(o>>>8&255),i.push(255&o),i=i.concat(Array.prototype.slice.call(s));for(n=0;n<r.pps.length;n++)s=r.pps[n],o=s.byteLength,a.push(o>>>8&255),a.push(255&o),a=a.concat(Array.prototype.slice.call(s));var l=e.box(e.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|r.sps.length].concat(i).concat([r.pps.length]).concat(a))),d=r.width,u=r.height,f=r.pixelRatio[0],c=r.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,255&d,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,255&f,c>>24,c>>16&255,c>>8&255,255&c])))},e.esds=function e(t){var r=t.config.length;return new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t.config).concat([6,1,2]))},e.mp4a=function t(r){var i=r.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(r)))},e.mp3=function t(r){var i=r.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function t(r){return"audio"===r.type?r.isAAC||"mp3"!==r.codec?e.box(e.types.stsd,e.STSD,e.mp4a(r)):e.box(e.types.stsd,e.STSD,e.mp3(r)):e.box(e.types.stsd,e.STSD,e.avc1(r))},e.tkhd=function t(r){var i=r.id,a=r.duration*r.timescale,n=r.width,s=r.height,o=Math.floor(a/(X+1)),l=Math.floor(a%(X+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,s>>8&255,255&s,0,0]))},e.traf=function t(r,i){var a=e.sdtp(r),n=r.id,s=Math.floor(i/(X+1)),o=Math.floor(i%(X+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(r,a.length+16+20+8+16+8+8),a)},e.trak=function t(r){return r.duration=r.duration||4294967295,e.box(e.types.trak,e.tkhd(r),e.mdia(r))},e.trex=function t(r){var i=r.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function t(r,i){var a=r.samples||[],n=a.length,s=12+16*n,o=new Uint8Array(s),l,d,u,f,c,h;for(i+=8+s,o.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),l=0;l<n;l++)d=a[l],u=d.duration,f=d.size,c=d.flags,h=d.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,f>>>24&255,f>>>16&255,f>>>8&255,255&f,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*l);return e.box(e.types.trun,o)},e.initSegment=function t(r){e.types||e.init();var i=e.moov(r),a;return a=new Uint8Array(e.FTYP.byteLength+i.byteLength),a.set(e.FTYP),a.set(i,e.FTYP.byteLength),a},e}(),Q=q,J=9e4,Z=m(10),$=m(.2),ee=function(){function e(e,t,r,i){this.observer=e,this.config=t,this.typeSupported=r;var a=navigator.userAgent;this.isSafari=i&&i.indexOf("Apple")>-1&&a&&!a.match("CriOS"),this.ISGenerated=!1}var t=e.prototype;return t.destroy=function e(){},t.resetTimeStamp=function e(t){this._initPTS=this._initDTS=t},t.resetInitSegment=function e(){this.ISGenerated=!1},t.remux=function e(t,r,i,a,n,s,o){if(this.ISGenerated||this.generateIS(t,r,n),this.ISGenerated){var l=t.samples.length,d=r.samples.length,u=n,f=n;if(l&&d){var c=(t.samples[0].pts-r.samples[0].pts)/r.inputTimeScale;u+=Math.max(0,c),f+=Math.max(0,-c)}if(l){t.timescale||(R.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(t,r,n));var h=this.remuxAudio(t,u,s,o),g;if(d)h&&(g=h.endPTS-h.startPTS),r.timescale||(R.logger.warn("regenerate InitSegment as video detected"),this.generateIS(t,r,n)),this.remuxVideo(r,f,s,g,o)}else if(d){var v=this.remuxVideo(r,f,s,0,o);v&&t.codec&&this.remuxEmptyAudio(t,u,s,v)}}i.samples.length&&this.remuxID3(i,n),a.samples.length&&this.remuxText(a,n),this.observer.trigger(y.default.FRAG_PARSED)},t.generateIS=function e(t,r,i){var a=this.observer,n=t.samples,s=r.samples,o=this.typeSupported,l="audio/mp4",d={},u={tracks:d},f=void 0===this._initPTS,c,h;if(f&&(c=h=1/0),t.config&&n.length&&(t.timescale=t.samplerate,R.logger.log("audio sampling rate : "+t.samplerate),t.isAAC||(o.mpeg?(l="audio/mpeg",t.codec=""):o.mp3&&(t.codec="mp3")),d.audio={container:l,codec:t.codec,initSegment:!t.isAAC&&o.mpeg?new Uint8Array:Q.initSegment([t]),metadata:{channelCount:t.channelCount}},f&&(c=h=n[0].pts-t.inputTimeScale*i)),r.sps&&r.pps&&s.length){var g=r.inputTimeScale;r.timescale=g,d.video={container:"video/mp4",codec:r.codec,initSegment:Q.initSegment([r]),metadata:{width:r.width,height:r.height}},f&&(c=Math.min(c,s[0].pts-g*i),h=Math.min(h,s[0].dts-g*i),this.observer.trigger(y.default.INIT_PTS_FOUND,{initPTS:c}))}Object.keys(d).length?(a.trigger(y.default.FRAG_PARSING_INIT_SEGMENT,u),this.ISGenerated=!0,f&&(this._initPTS=c,this._initDTS=h)):a.trigger(y.default.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.remuxVideo=function e(t,r,i,a,n){var s=8,o,l,d,u,f,c,h,g=t.timescale,v=t.samples,m=[],b=v.length,T=this._PTSNormalize,S=this._initPTS,A=this.nextAvcDts,_=this.isSafari;if(0!==b){_&&(i|=v.length&&A&&(n&&Math.abs(r-A/g)<.1||Math.abs(v[0].pts-A-S)<g/5)),i||(A=r*g),v.forEach(function(e){e.pts=T(e.pts-S,A),e.dts=T(e.dts-S,A)}),v.sort(function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||i||e.id-t.id});var L=v.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-1*$)},0);if(L<0){R.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+p(L,!0)+" ms to overcome this issue");for(var D=0;D<v.length;D++)v[D].dts+=L}var w=v[0];f=Math.max(w.dts,0),u=Math.max(w.pts,0);var k=f-A;i&&k&&(k>1?R.logger.log("AVC: "+p(k,!0)+" ms hole between fragments detected,filling it"):k<-1&&R.logger.log("AVC: "+p(-k,!0)+" ms overlapping between fragments detected"),f=A,v[0].dts=f,u=Math.max(u-k,A),v[0].pts=u,R.logger.log("Video: PTS/DTS adjusted: "+p(u,!0)+"/"+p(f,!0)+", delta: "+p(k,!0)+" ms")),w=v[v.length-1],h=Math.max(w.dts,0),c=Math.max(w.pts,0,h),_&&(o=Math.round((h-f)/(v.length-1)));for(var I=0,O=0,x=0;x<b;x++){for(var P=v[x],C=P.units,F=C.length,M=0,N=0;N<F;N++)M+=C[N].data.length;O+=M,I+=F,P.length=M,P.dts=_?f+x*o:Math.max(P.dts,f),P.pts=Math.max(P.pts,P.dts)}var U=O+4*I+8;try{l=new Uint8Array(U)}catch(se){return void this.observer.trigger(y.default.ERROR,{type:E.ErrorTypes.MUX_ERROR,details:E.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating video mdat "+U})}var B=new DataView(l.buffer);B.setUint32(0,U),l.set(Q.types.mdat,4);for(var G=0;G<b;G++){for(var j=v[G],K=j.units,H=0,V=void 0,W=0,Y=K.length;W<Y;W++){var z=K[W],X=z.data,q=z.data.byteLength;B.setUint32(s,q),s+=4,l.set(X,s),s+=q,H+=4+q}if(_)V=Math.max(0,o*Math.round((j.pts-j.dts)/o));else{if(G<b-1)o=v[G+1].dts-j.dts;else{var J=this.config,Z=j.dts-v[G>0?G-1:G].dts;if(J.stretchShortVideoTrack){var ee=J.maxBufferHole,te=Math.floor(ee*g),re=(a?u+a*g:this.nextAudioPts)-j.pts;re>te?(o=re-Z,o<0&&(o=Z),R.logger.log("It is approximately "+p(re,!1)+" ms to the next segment; using duration "+p(o,!1)+" ms for the last video frame.")):o=Z}else o=Z}V=Math.round(j.pts-j.dts)}m.push({size:H,duration:o,cts:V,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:j.key?2:1,isNonSync:j.key?0:1}})}this.nextAvcDts=h+o;var ie=t.dropped;if(t.nbNalu=0,t.dropped=0,m.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ae=m[0].flags;ae.dependsOn=2,ae.isNonSync=0}t.samples=m,d=Q.moof(t.sequenceNumber++,f,t),t.samples=[];var ne={data1:d,data2:l,startPTS:u/g,endPTS:(c+o)/g,startDTS:f/g,endDTS:this.nextAvcDts/g,type:"video",hasAudio:!1,hasVideo:!0,nb:m.length,dropped:ie};return this.observer.trigger(y.default.FRAG_PARSING_DATA,ne),ne}},t.remuxAudio=function e(t,r,i,a){var n=t.inputTimeScale,s=t.timescale,o=n/s,l=t.isAAC?1024:1152,d=l*o,u=this._PTSNormalize,f=this._initPTS,c=!t.isAAC&&this.typeSupported.mpeg,h,g,v,m,b,T,S=c?0:8,A=t.samples,_=[],L=this.nextAudioPts;if(i|=A.length&&L&&(a&&Math.abs(r-L/n)<.1||Math.abs(A[0].pts-L-f)<20*d),A.forEach(function(e){e.pts=e.dts=u(e.pts-f,r*n)}),A=A.filter(function(e){return e.pts>=0}),0!==A.length){if(i||(L=a?r*n:A[0].pts),t.isAAC)for(var D=this.config.maxAudioFramesDrift,w=0,k=L;w<A.length;){var I=A[w],O,x=I.pts;if(O=x-k,O<=-D*d)R.logger.warn("Dropping 1 audio frame @ "+p(k,!0)+" ms due to "+p(O,!0)+" ms overlap."),A.splice(w,1);else if(O>=D*d&&O<Z&&k){var P=Math.round(O/d);R.logger.warn("Injecting "+P+" audio frames @ "+p(k,!0)+" ms due to "+p(k,!0)+" ms gap.");for(var C=0;C<P;C++){var F=Math.max(k,0);g=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),g||(R.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),g=I.unit.subarray()),A.splice(w,0,{unit:g,pts:F,dts:F}),k+=d,w++}I.pts=I.dts=k,k+=d,w++}else Math.abs(O),I.pts=I.dts=k,k+=d,w++}for(var M=A.length,N=0;M--;)N+=A[M].unit.byteLength;for(var U=0,B=A.length;U<B;U++){var G=A[U],j=G.unit,K=G.pts;if(void 0!==T)h.duration=Math.round((K-T)/o);else{var H=K-L,V=0;if(i&&t.isAAC&&H){if(H>0&&H<Z)V=Math.round((K-L)/d),R.logger.log(p(H,!0)+" ms hole between AAC samples detected,filling it"),V>0&&(g=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),g||(g=j.subarray()),N+=V*g.length);else if(H<-12){R.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+p(L,!0)+" ms / "+p(K,!0)+" ms / "+p(-H,!0)+" ms"),N-=j.byteLength;continue}K=L}if(b=K,!(N>0))return;N+=S;try{v=new Uint8Array(N)}catch(te){return void this.observer.trigger(y.default.ERROR,{type:E.ErrorTypes.MUX_ERROR,details:E.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating audio mdat "+N})}if(!c){var W=new DataView(v.buffer);W.setUint32(0,N),v.set(Q.types.mdat,4)}for(var Y=0;Y<V;Y++)g=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),g||(R.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),g=j.subarray()),v.set(g,S),S+=g.byteLength,h={size:g.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},_.push(h)}v.set(j,S);var X=j.byteLength;S+=X,h={size:X,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},_.push(h),T=K}var q=0;if(M=_.length,M>=2&&(q=_[M-2].duration,h.duration=q),M){this.nextAudioPts=L=T+o*q,t.samples=_,m=c?new Uint8Array:Q.moof(t.sequenceNumber++,b/o,t),t.samples=[];var J=b/n,$=L/n,ee={data1:m,data2:v,startPTS:J,endPTS:$,startDTS:J,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:M};return this.observer.trigger(y.default.FRAG_PARSING_DATA,ee),ee}return null}},t.remuxEmptyAudio=function e(t,r,i,a){var n=t.inputTimeScale,s=t.samplerate?t.samplerate:n,o=n/s,l=this.nextAudioPts,d=(void 0!==l?l:a.startDTS*n)+this._initDTS,u=a.endDTS*n+this._initDTS,f=1024,c=1024*o,h=Math.ceil((u-d)/c),g=z.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(R.logger.warn("remux empty Audio"),g){for(var v=[],p=0;p<h;p++){var m=d+p*c;v.push({unit:g,pts:m,dts:m})}t.samples=v,this.remuxAudio(t,r,i)}else R.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.remuxID3=function e(t){var r=t.samples.length,i,a=t.inputTimeScale,n=this._initPTS,s=this._initDTS;if(r){for(var o=0;o<r;o++)i=t.samples[o],i.pts=(i.pts-n)/a,i.dts=(i.dts-s)/a;this.observer.trigger(y.default.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[]},t.remuxText=function e(t){t.samples.sort(function(e,t){return e.pts-t.pts});var r=t.samples.length,i,a=t.inputTimeScale,n=this._initPTS;if(r){for(var s=0;s<r;s++)i=t.samples[s],i.pts=(i.pts-n)/a;this.observer.trigger(y.default.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]},t._PTSNormalize=function e(t,r){var i;if(void 0===r)return t;for(i=r<t?-8589934592:8589934592;Math.abs(t-r)>4294967296;)t+=i;return t},e}(),te=ee,re=function(){function e(e){this.observer=e}var t=e.prototype;return t.destroy=function e(){},t.resetTimeStamp=function e(){},t.resetInitSegment=function e(){},t.remux=function e(t,r,i,a,n,s,o,l){var d=this.observer,u="";t&&(u+="audio"),r&&(u+="video"),d.trigger(y.default.FRAG_PARSING_DATA,{data1:l,startPTS:n,startDTS:n,type:u,hasAudio:!!t,hasVideo:!!r,nb:1,dropped:0}),d.trigger(y.default.FRAG_PARSED)},e}(),ie=re,ae=Object(L.getSelfScope)(),ne;try{ne=ae.performance.now.bind(ae.performance)}catch(le){R.logger.debug("Unable to use Performance API on this environment"),ne=ae.Date.now}var se=function(){function e(e,t,r,i){this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i}var t=e.prototype;return t.destroy=function e(){var t=this.demuxer;t&&t.destroy()},t.push=function e(t,r,i,a,n,s,o,l,d,u,f,c){var h=this;if(t.byteLength>0&&null!=r&&null!=r.key&&"AES-128"===r.method){var g=this.decrypter;null==g&&(g=this.decrypter=new k(this.observer,this.config));var v=ne();g.decrypt(t,r.key.buffer,r.iv.buffer,function(e){var t=ne();h.observer.trigger(y.default.FRAG_DECRYPTED,{stats:{tstart:v,tdecrypt:t}}),h.pushDecrypted(new Uint8Array(e),r,new Uint8Array(i),a,n,s,o,l,d,u,f,c)})}else this.pushDecrypted(new Uint8Array(t),r,new Uint8Array(i),a,n,s,o,l,d,u,f,c)},t.pushDecrypted=function e(t,r,i,a,n,s,o,l,d,u,f,c){var h=this.demuxer;if(!h||(o||l)&&!this.probe(t)){for(var g=this.observer,v=this.typeSupported,p=this.config,m=[{demux:H,remux:te},{demux:C.default,remux:ie},{demux:P,remux:te},{demux:W,remux:te}],b=0,T=m.length;b<T;b++){var S=m[b],A=S.demux.probe;if(A(t)){var _=this.remuxer=new S.remux(g,p,v,this.vendor);h=new S.demux(g,_,p,v),this.probe=A;break}}if(!h)return void g.trigger(y.default.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=h}var R=this.remuxer;(o||l)&&(h.resetInitSegment(i,a,n,u),R.resetInitSegment()),o&&(h.resetTimeStamp(c),R.resetTimeStamp(c)),"function"==typeof h.setDecryptData&&h.setDecryptData(r),h.append(t,s,d,f)},e}(),oe=t.default=se},"./src/demux/demuxer-worker.js":
/*!*************************************!*\
  !*** ./src/demux/demuxer-worker.js ***!
  \*************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Module is referenced from these modules with unsupported syntax: ./src/demux/demuxer.js (referenced with require.resolve) */function(e,t,r){"use strict";r.r(t);var i=r(/*! ../demux/demuxer-inline */"./src/demux/demuxer-inline.js"),a=r(/*! ../events */"./src/events.js"),n=r(/*! ../utils/logger */"./src/utils/logger.js"),s=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),o=r.n(s),l=function e(t){var r=new s.EventEmitter;r.trigger=function e(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];r.emit.apply(r,[t,t].concat(a))},r.off=function e(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];r.removeListener.apply(r,[t].concat(a))};var o=function e(r,i){t.postMessage({event:r,data:i})};t.addEventListener("message",function(e){var a=e.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);t.demuxer=new i.default(r,a.typeSupported,s,a.vendor),Object(n.enableLogs)(s.debug),o("init",null);break;case"demux":t.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}}),r.on(a.default.FRAG_DECRYPTED,o),r.on(a.default.FRAG_PARSING_INIT_SEGMENT,o),r.on(a.default.FRAG_PARSED,o),r.on(a.default.ERROR,o),r.on(a.default.FRAG_PARSING_METADATA,o),r.on(a.default.FRAG_PARSING_USERDATA,o),r.on(a.default.INIT_PTS_FOUND,o),r.on(a.default.FRAG_PARSING_DATA,function(e,r){var i=[],a={event:e,data:r};r.data1&&(a.data1=r.data1.buffer,i.push(r.data1.buffer),delete r.data1),r.data2&&(a.data2=r.data2.buffer,i.push(r.data2.buffer),delete r.data2),t.postMessage(a,i)})};t.default=l},"./src/demux/id3.js":
/*!**************************!*\
  !*** ./src/demux/id3.js ***!
  \**************************/
/*! exports provided: default, utf8ArrayToStr */function(e,t,r){"use strict";function i(){var e=Object(a.getSelfScope)();return s||void 0===e.TextDecoder||(s=new e.TextDecoder("utf-8")),s}r.r(t),r.d(t,"utf8ArrayToStr",function(){return o});var a=r(/*! ../utils/get-self-scope */"./src/utils/get-self-scope.js"),n=function(){function e(){}return e.isHeader=function e(t,r){return r+10<=t.length&&73===t[r]&&68===t[r+1]&&51===t[r+2]&&t[r+3]<255&&t[r+4]<255&&t[r+6]<128&&t[r+7]<128&&t[r+8]<128&&t[r+9]<128},e.isFooter=function e(t,r){return r+10<=t.length&&51===t[r]&&68===t[r+1]&&73===t[r+2]&&t[r+3]<255&&t[r+4]<255&&t[r+6]<128&&t[r+7]<128&&t[r+8]<128&&t[r+9]<128},e.getID3Data=function t(r,i){for(var a=i,n=0;e.isHeader(r,i);){n+=10;var s=e._readSize(r,i+6);n+=s,e.isFooter(r,i+10)&&(n+=10),i+=n}if(n>0)return r.subarray(a,a+n)},e._readSize=function e(t,r){var i=0;return i=(127&t[r])<<21,i|=(127&t[r+1])<<14,i|=(127&t[r+2])<<7,i|=127&t[r+3],i},e.getTimeStamp=function t(r){for(var i=e.getID3Frames(r),a=0;a<i.length;a++){var n=i[a];if(e.isTimeStampFrame(n))return e._readTimeStamp(n)}},e.isTimeStampFrame=function e(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},e._getFrameData=function t(r){var i=String.fromCharCode(r[0],r[1],r[2],r[3]),a=e._readSize(r,4),n=10;return{type:i,size:a,data:r.subarray(10,10+a)}},e.getID3Frames=function t(r){for(var i=0,a=[];e.isHeader(r,i);){var n=e._readSize(r,i+6);i+=10;for(var s=i+n;i+8<s;){var o=e._getFrameData(r.subarray(i)),l=e._decodeFrame(o);l&&a.push(l),i+=o.size+10}e.isFooter(r,i)&&(i+=10)}return a},e._decodeFrame=function t(r){return"PRIV"===r.type?e._decodePrivFrame(r):"T"===r.type[0]?e._decodeTextFrame(r):"W"===r.type[0]?e._decodeURLFrame(r):void 0},e._readTimeStamp=function e(t){if(8===t.data.byteLength){var r=new Uint8Array(t.data),i=1&r[3],a=(r[4]<<23)+(r[5]<<15)+(r[6]<<7)+r[7];return a/=45,i&&(a+=47721858.84),Math.round(a)}},e._decodePrivFrame=function t(r){if(!(r.size<2)){var i=e._utf8ArrayToStr(r.data,!0),a=new Uint8Array(r.data.subarray(i.length+1));return{key:r.type,info:i,data:a.buffer}}},e._decodeTextFrame=function t(r){if(!(r.size<2)){if("TXXX"===r.type){var i=1,a=e._utf8ArrayToStr(r.data.subarray(i),!0);i+=a.length+1;var n=e._utf8ArrayToStr(r.data.subarray(i));return{key:r.type,info:a,data:n}}var s=e._utf8ArrayToStr(r.data.subarray(1));return{key:r.type,data:s}}},e._decodeURLFrame=function t(r){if("WXXX"===r.type){if(r.size<2)return;var i=1,a=e._utf8ArrayToStr(r.data.subarray(i));i+=a.length+1;var n=e._utf8ArrayToStr(r.data.subarray(i));return{key:r.type,info:a,data:n}}var s=e._utf8ArrayToStr(r.data);return{key:r.type,data:s}},e._utf8ArrayToStr=function e(t,r){void 0===r&&(r=!1);var a=i();if(a){var n=a.decode(t);if(r){var s=n.indexOf("\0");return-1!==s?n.substring(0,s):n}return n.replace(/\0/g,"")}for(var o=t.length,l,d,u,f="",c=0;c<o;){if(l=t[c++],0===l&&r)return f;if(0!==l&&3!==l)switch(l>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:f+=String.fromCharCode(l);break;case 12:case 13:d=t[c++],f+=String.fromCharCode((31&l)<<6|63&d);break;case 14:d=t[c++],u=t[c++],f+=String.fromCharCode((15&l)<<12|(63&d)<<6|(63&u)<<0)}}return f},e}(),s,o=n._utf8ArrayToStr;t.default=n},"./src/demux/mp4demuxer.js":
/*!*********************************!*\
  !*** ./src/demux/mp4demuxer.js ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var i=r(/*! ../utils/logger */"./src/utils/logger.js"),a=r(/*! ../events */"./src/events.js"),n=Math.pow(2,32)-1,s=function(){function e(e,t){this.observer=e,this.remuxer=t}var t=e.prototype;return t.resetTimeStamp=function e(t){this.initPTS=t},t.resetInitSegment=function t(r,i,n,s){if(r&&r.byteLength){var o=this.initData=e.parseInitSegment(r);null==i&&(i="mp4a.40.5"),null==n&&(n="avc1.42e01e");var l={};o.audio&&o.video?l.audiovideo={container:"video/mp4",codec:i+","+n,initSegment:s?r:null}:(o.audio&&(l.audio={container:"audio/mp4",codec:i,initSegment:s?r:null}),o.video&&(l.video={container:"video/mp4",codec:n,initSegment:s?r:null})),this.observer.trigger(a.default.FRAG_PARSING_INIT_SEGMENT,{tracks:l})}else i&&(this.audioCodec=i),n&&(this.videoCodec=n)},e.probe=function t(r){return e.findBox({data:r,start:0,end:Math.min(r.length,16384)},["moof"]).length>0},e.bin2str=function e(t){return String.fromCharCode.apply(null,t)},e.readUint16=function e(t,r){t.data&&(r+=t.start,t=t.data);var i=t[r]<<8|t[r+1];return i<0?65536+i:i},e.readUint32=function e(t,r){t.data&&(r+=t.start,t=t.data);var i=t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3];return i<0?4294967296+i:i},e.writeUint32=function e(t,r,i){t.data&&(r+=t.start,t=t.data),t[r]=i>>24,t[r+1]=i>>16&255,t[r+2]=i>>8&255,t[r+3]=255&i},e.findBox=function t(r,i){var a=[],n,s,o,l,d,u,f;if(r.data?(u=r.start,l=r.end,r=r.data):(u=0,l=r.byteLength),!i.length)return null;for(n=u;n<l;)s=e.readUint32(r,n),o=e.bin2str(r.subarray(n+4,n+8)),f=s>1?n+s:l,o===i[0]&&(1===i.length?a.push({data:r,start:n+8,end:f}):(d=e.findBox({data:r,start:n+8,end:f},i.slice(1)),d.length&&(a=a.concat(d)))),n=f;return a},e.parseSegmentIndex=function t(r){var i=e.findBox(r,["moov"])[0],a=i?i.end:null,n=0,s=e.findBox(r,["sidx"]),o;if(!s||!s[0])return null;o=[],s=s[0];var l=s.data[0];n=0===l?8:16;var d=e.readUint32(s,n);n+=4;var u=0,f=0;n+=0===l?8:16,n+=2;var c=s.end+0,h=e.readUint16(s,n);n+=2;for(var g=0;g<h;g++){var v=n,p=e.readUint32(s,v);v+=4;var m=2147483647&p,y=(2147483648&p)>>>31;if(1===y)return void console.warn("SIDX has hierarchical references (not supported)");var E=e.readUint32(s,v);v+=4,o.push({referenceSize:m,subsegmentDuration:E,info:{duration:E/d,start:c,end:c+m-1}}),c+=m,v+=4,n=v}return{earliestPresentationTime:0,timescale:d,version:l,referencesCount:h,references:o,moovEndOffset:a}},e.parseInitSegment=function t(r){var a=[],n=e.findBox(r,["moov","trak"]);return n.forEach(function(t){var r=e.findBox(t,["tkhd"])[0];if(r){var n=r.data[r.start],s=0===n?12:20,o=e.readUint32(r,s),l=e.findBox(t,["mdia","mdhd"])[0];if(l){n=l.data[l.start],s=0===n?12:20;var d=e.readUint32(l,s),u=e.findBox(t,["mdia","hdlr"])[0];if(u){var f=e.bin2str(u.data.subarray(u.start+8,u.start+12)),c={soun:"audio",vide:"video"}[f];if(c){var h=e.findBox(t,["mdia","minf","stbl","stsd"]);if(h.length){h=h[0];var g=e.bin2str(h.data.subarray(h.start+12,h.start+16));i.logger.log("MP4Demuxer:"+c+":"+g+" found")}a[o]={timescale:d,type:c},a[c]={timescale:d,id:o}}}}}}),a},e.getStartDTS=function t(r,i){var a,n,s;return a=e.findBox(i,["moof","traf"]),n=[].concat.apply([],a.map(function(t){return e.findBox(t,["tfhd"]).map(function(i){var a,n,s;return a=e.readUint32(i,4),n=r[a].timescale||9e4,s=e.findBox(t,["tfdt"]).map(function(t){var r,i;return r=t.data[t.start],i=e.readUint32(t,4),1===r&&(i*=Math.pow(2,32),i+=e.readUint32(t,8)),i})[0],s/n})})),s=Math.min.apply(null,n),isFinite(s)?s:0},e.offsetStartDTS=function t(r,i,a){e.findBox(i,["moof","traf"]).map(function(t){return e.findBox(t,["tfhd"]).map(function(i){var s=e.readUint32(i,4),o=r[s].timescale||9e4;e.findBox(t,["tfdt"]).map(function(t){var r=t.data[t.start],i=e.readUint32(t,4);if(0===r)e.writeUint32(t,4,i-a*o);else{i*=Math.pow(2,32),i+=e.readUint32(t,8),i-=a*o,i=Math.max(i,0);var s=Math.floor(i/(n+1)),l=Math.floor(i%(n+1));e.writeUint32(t,4,s),e.writeUint32(t,8,l)}})})})},t.append=function t(r,i,n,s){var o=this.initData;o||(this.resetInitSegment(r,this.audioCodec,this.videoCodec,!1),o=this.initData);var l,d=this.initPTS;if(void 0===d){var u=e.getStartDTS(o,r);this.initPTS=d=u-i,this.observer.trigger(a.default.INIT_PTS_FOUND,{initPTS:d})}e.offsetStartDTS(o,r,d),l=e.getStartDTS(o,r),this.remuxer.remux(o.audio,o.video,null,null,l,n,s,r)},t.destroy=function e(){},e}();t.default=s},"./src/empty.js":
/*!**********************!*\
  !*** ./src/empty.js ***!
  \**********************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t){e.exports=void 0},"./src/errors.ts":
/*!***********************!*\
  !*** ./src/errors.ts ***!
  \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(e,t,r){"use strict";var i,a;r.r(t),r.d(t,"ErrorTypes",function(){return i}),r.d(t,"ErrorDetails",function(){return a}),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError"}(i||(i={})),function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException"}(a||(a={}))},"./src/events.js":
/*!***********************!*\
  !*** ./src/events.js ***!
  \***********************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var i={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"};t.default=i},"./src/hls.ts":
/*!*********************************!*\
  !*** ./src/hls.ts + 38 modules ***!
  \*********************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/demuxer-inline.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number-isFinite.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/eventemitter3/index.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/url-toolkit/src/url-toolkit.js (<- Module is not an ECMAScript module) */function(e,t,r){"use strict";function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}function d(e,t){var r=Me[t];return!!r&&!0===r[e.slice(0,4)]}function u(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}function f(e,t){for(var r=e[t],i=t-1;i>=0;i--){var a=e[i];a.programDateTime=r.programDateTime-1e3*a.duration,r=a}}function c(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(Ee.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function h(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function g(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function v(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function m(){return window.MediaSource||window.WebKitMediaSource}function y(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function E(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r)}}function b(e,t,r){var i=e[t],a=e[r],n=a.startPTS;Object(Ee.isFiniteNumber)(n)?r>t?(i.duration=n-i.start,i.duration<0&&Te.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(a.duration=i.start-n,a.duration<0&&Te.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):a.start=r>t?i.start+i.duration:Math.max(i.start-a.duration,0)}function T(e,t,r,i,a,n){var s=r;if(Object(Ee.isFiniteNumber)(t.startPTS)){var o=Math.abs(t.startPTS-r);Object(Ee.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(o,t.deltaPTS):t.deltaPTS=o,s=Math.max(r,t.startPTS),r=Math.min(r,t.startPTS),i=Math.max(i,t.endPTS),a=Math.min(a,t.startDTS),n=Math.max(n,t.endDTS)}var l=r-t.start;t.start=t.startPTS=r,t.maxStartPTS=s,t.endPTS=i,t.startDTS=a,t.endDTS=n,t.duration=i-r;var d=t.sn,u,f,c;if(!e||d<e.startSN||d>e.endSN)return 0;for(u=d-e.startSN,f=e.fragments,f[u]=t,c=u;c>0;c--)b(f,c,c-1);for(c=u;c<f.length-1;c++)b(f,c,c+1);return e.PTSKnown=!0,l}function S(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var r=0,i;if(_(e,t,function(e,a){r=e.cc-a.cc,Object(Ee.isFiniteNumber)(e.startPTS)&&(a.start=a.startPTS=e.startPTS,a.endPTS=e.endPTS,a.duration=e.duration,a.backtracked=e.backtracked,a.dropped=e.dropped,i=a),t.PTSKnown=!0}),t.PTSKnown){if(r){Te.logger.log("discontinuity sliding from playlist, take drift into account");for(var a=t.fragments,n=0;n<a.length;n++)a[n].cc+=r}i?T(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):R(e,t),t.PTSKnown=e.PTSKnown}}function A(e,t,r){void 0===r&&(r=0);var i=-1;_(e,t,function(e,t,r){t.start=e.start,i=r});var a=t.fragments;if(i<0)a.forEach(function(e){e.start+=r});else for(var n=i+1;n<a.length;n++)a[n].start=a[n-1].start+a[n-1].duration}function _(e,t,r){if(e&&t)for(var i=Math.max(e.startSN,t.startSN)-t.startSN,a=Math.min(e.endSN,t.endSN)-t.startSN,n=t.startSN-e.startSN,s=i;s<=a;s++){var o=e.fragments[n+s],l=t.fragments[s];if(!o||!l)break;r(o,l,s)}}function R(e,t){var r=t.startSN-e.startSN,i=e.fragments,a=t.fragments;if(!(r<0||r>i.length))for(var n=0;n<a.length;n++)a[n].start+=i[r].start}function L(e,t,r){var i=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),a=i/2;return e&&t.endSN===e.endSN&&(i=a),r&&(i=Math.max(a,i-(window.performance.now()-r))),Math.round(i)}function D(e,t){for(var r=null,i=0;i<e.length;i+=1){var a=e[i];if(a&&a.cc===t){r=a;break}}return r}function w(e,t){return it.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}function k(e,t,r){var i=!1;return t&&t.details&&r&&(r.endCC>r.startCC||e&&e.cc<r.startCC)&&(i=!0),i}function I(e,t){var r=e.fragments,i=t.fragments;if(i.length&&r.length){var a=D(r,i[0].cc);if(a&&(!a||a.startPTS))return a;Te.logger.log("No frag in previous level to align on")}else Te.logger.log("No fragments to align")}function O(e,t){t.fragments.forEach(function(t){if(t){var r=t.start+e;t.start=t.startPTS=r,t.endPTS=r+t.duration}}),t.PTSKnown=!0}function x(e,t,r){P(e,r,t),!r.PTSKnown&&t&&C(r,t.details)}function P(e,t,r){if(k(e,r,t)){var i=I(r.details,t);i&&(Te.logger.log("Adjusting PTS using last level due to CC increase within current level"),O(i.start,t))}}function C(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var r=t.fragments[0].programDateTime,i=e.fragments[0].programDateTime,a=(i-r)/1e3+t.fragments[0].start;Object(Ee.isFiniteNumber)(a)&&(Te.logger.log("adjusting PTS using programDateTime delta, sliding:"+a.toFixed(3)),O(a,e))}}function F(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!Object(Ee.isFiniteNumber)(t))return null;var i=e[0].programDateTime;if(t<(i||0))return null;var a=e[e.length-1].endProgramDateTime;if(t>=(a||0))return null;r=r||0;for(var n=0;n<e.length;++n){var s=e[n];if(U(t,r,s))return s}return null}function M(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var a=e?t[e.sn-t[0].sn+1]:null;return a&&!N(r,i,a)?a:it.search(t,N.bind(null,r,i))}function N(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0);var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=e?1:r.start-i>e&&r.start?-1:0}function U(e,t,r){var i=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0)),a=r.endProgramDateTime||0;return a-i>e}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function j(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function K(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function H(e,t,r){return t&&K(e.prototype,t),r&&K(e,r),e}function V(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function W(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Y(e,t,r){return t&&W(e.prototype,t),r&&W(e,r),e}function z(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function X(e,t){var r;try{r=new Event("addtrack")}catch(i){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function q(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}function Q(e,t){if(t<e[0].endTime)return e[0];if(t>e[e.length-1].endTime)return e[e.length-1];for(var r=0,i=e.length-1;r<=i;){var a=Math.floor((i+r)/2);if(t<e[a].endTime)i=a-1;else{if(!(t>e[a].endTime))return e[a];r=a+1}}return e[r].endTime-t<t-e[i].endTime?e[r]:e[i]}function J(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function Z(){var e=m();if(!e)return!1;var t=self.SourceBuffer||self.WebKitSourceBuffer,r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!i}function $(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ee(e,t,r){return t&&$(e.prototype,t),r&&$(e,r),e}function te(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function re(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function ie(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function ae(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ne(e,t,r){return t&&ae(e.prototype,t),r&&ae(e,r),e}function se(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function oe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function le(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),i.forEach(function(t){de(e,t,r[t])})}return e}function de(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(){return{}}function fe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),i.forEach(function(t){ce(e,t,r[t])})}return e}function ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function he(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ge(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ve(e,t,r){return t&&ge(e.prototype,t),r&&ge(e,r),e}function pe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}r.r(t);var me=r("./node_modules/url-toolkit/src/url-toolkit.js"),ye=r("./src/errors.ts"),Ee=r("./src/polyfills/number-isFinite.js"),be=r("./src/events.js"),Te=r("./src/utils/logger.js"),Se={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},Ae=function(){function e(e){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}var t=e.prototype;return t.destroy=function e(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.onHandlerDestroying=function e(){},t.onHandlerDestroyed=function e(){},t.isEventHandler=function e(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.registerListeners=function e(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(Se[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},t.unregisterListeners=function e(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},t.onEvent=function e(t,r){this.onEventGeneric(t,r)},t.onEventGeneric=function e(t,r){var i=function e(t,r){var i="on"+t.replace("hls","");if("function"!=typeof this[i])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+i+")");return this[i].bind(this,r)};try{i.call(this,t,r).call()}catch(a){Te.logger.error("An internal error happened while handling event "+t+'. Error message: "'+a.message+'". Here is a stacktrace:',a),this.hls.trigger(be.default.ERROR,{type:ye.ErrorTypes.OTHER_ERROR,details:ye.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:a})}},e}(),_e=Ae,Re,Le;!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(Re||(Re={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(Le||(Le={}));var De=r("./src/demux/mp4demuxer.js"),we=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}return a(e,[{key:"uri",get:function e(){return!this._uri&&this.reluri&&(this._uri=Object(me.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}(),ke;!function(e){e.AUDIO="audio",e.VIDEO="video"}(ke||(ke={}));var Ie=function(){function e(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=(e={},e[ke.AUDIO]=!1,e[ke.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var t=e.prototype;return t.setByteRange=function e(t,r){var i=t.split("@",2),a=[];1===i.length?a[0]=r?r.byteRangeEndOffset:0:a[0]=parseInt(i[1]),a[1]=parseInt(i[0])+a[0],this._byteRange=a},t.addElementaryStream=function e(t){this._elementaryStreams[t]=!0},t.hasElementaryStream=function e(t){return!0===this._elementaryStreams[t]},t.createInitializationVector=function e(t){for(var r=new Uint8Array(16),i=12;i<16;i++)r[i]=t>>8*(15-i)&255;return r},t.setDecryptDataFromLevelKey=function e(t,r){var i=t;return t&&t.method&&t.uri&&!t.iv&&(i=new we(t.baseuri,t.reluri),i.method=t.method,i.iv=this.createInitializationVector(r)),i},s(e,[{key:"url",get:function e(){return!this._url&&this.relurl&&(this._url=Object(me.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function e(t){this._url=t}},{key:"byteRange",get:function e(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function e(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function e(){return this.byteRange[1]}},{key:"decryptdata",get:function e(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var t=this.sn;"number"!=typeof t&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&Te.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)}return this._decryptdata}},{key:"endProgramDateTime",get:function e(){if(null===this.programDateTime)return null;if(!Object(Ee.isFiniteNumber)(this.programDateTime))return null;var t=Object(Ee.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function e(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}]),e}(),Oe=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}return l(e,[{key:"hasProgramDateTime",get:function e(){return!(!this.fragments[0]||!Object(Ee.isFiniteNumber)(this.fragments[0].programDateTime))}}]),e}(),xe=/^(\d+)x(\d+)$/,Pe=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Ce=function(){function e(t){for(var r in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&(this[r]=t[r])}var t=e.prototype;return t.decimalInteger=function e(t){var r=parseInt(this[t],10);return r>Number.MAX_SAFE_INTEGER?1/0:r},t.hexadecimalInteger=function e(t){if(this[t]){var r=(this[t]||"0x").slice(2);r=(1&r.length?"0":"")+r;for(var i=new Uint8Array(r.length/2),a=0;a<r.length/2;a++)i[a]=parseInt(r.slice(2*a,2*a+2),16);return i}return null},t.hexadecimalIntegerAsNumber=function e(t){var r=parseInt(this[t],16);return r>Number.MAX_SAFE_INTEGER?1/0:r},t.decimalFloatingPoint=function e(t){return parseFloat(this[t])},t.enumeratedString=function e(t){return this[t]},t.decimalResolution=function e(t){var r=xe.exec(this[t]);if(null!==r)return{width:parseInt(r[1],10),height:parseInt(r[2],10)}},e.parseAttrList=function e(t){var r,i={};for(Pe.lastIndex=0;null!==(r=Pe.exec(t));){var a=r[2],n='"';0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1&&(a=a.slice(1,-1)),i[r[1]]=a}return i},e}(),Fe=Ce,Me={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Ne=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,Ue=/#EXT-X-MEDIA:(.*)/g,Be=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Ge=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,je=/\.(mp4|m4s|m4v|m4a)$/i,Ke=function(){function e(){}return e.findGroup=function e(t,r){for(var i=0;i<t.length;i++){var a=t[i];if(a.id===r)return a}},e.convertAVC1ToAVCOTI=function e(t){var r=t.split("."),i;return r.length>2?(i=r.shift()+".",i+=parseInt(r.shift()).toString(16),i+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):i=t,i},e.resolve=function e(t,r){return me.buildAbsoluteURL(r,t,{alwaysNormalize:!0})},e.parseMasterPlaylist=function t(r,i){function a(e,t){["video","audio"].forEach(function(r){var i=e.filter(function(e){return d(e,r)});if(i.length){var a=i.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[r+"Codec"]=a.length>0?a[0]:i[0],e=e.filter(function(e){return-1===i.indexOf(e)})}}),t.unknownCodecs=e}var n=[],s;for(Ne.lastIndex=0;null!=(s=Ne.exec(r));){var o={},l=o.attrs=new Fe(s[1]);o.url=e.resolve(s[2],i);var u=l.decimalResolution("RESOLUTION");u&&(o.width=u.width,o.height=u.height),o.bitrate=l.decimalInteger("AVERAGE-BANDWIDTH")||l.decimalInteger("BANDWIDTH"),o.name=l.NAME,a([].concat((l.CODECS||"").split(/[ ,]+/)),o),o.videoCodec&&-1!==o.videoCodec.indexOf("avc1")&&(o.videoCodec=e.convertAVC1ToAVCOTI(o.videoCodec)),n.push(o)}return n},e.parseMasterPlaylistMedia=function t(r,i,a,n){var s;void 0===n&&(n=[]);var o=[],l=0;for(Ue.lastIndex=0;null!==(s=Ue.exec(r));){var d=new Fe(s[1]);if(d.TYPE===a){var u={id:l++,groupId:d["GROUP-ID"],name:d.NAME||d.LANGUAGE,type:a,default:"YES"===d.DEFAULT,autoselect:"YES"===d.AUTOSELECT,forced:"YES"===d.FORCED,lang:d.LANGUAGE};if(d.URI&&(u.url=e.resolve(d.URI,i)),n.length){var f=e.findGroup(n,u.groupId);u.audioCodec=f?f.codec:n[0].codec}o.push(u)}}return o},e.parseLevelPlaylist=function e(t,r,i,a,n){var s=0,o=0,l=new Oe(r),d=0,u=null,h=new Ie,g,v,p,m=null;for(Be.lastIndex=0;null!==(g=Be.exec(t));){var y=g[1];if(y){h.duration=parseFloat(y);var E=(" "+g[2]).slice(1);h.title=E||null,h.tagList.push(E?["INF",y,E]:["INF",y])}else if(g[3]){if(Object(Ee.isFiniteNumber)(h.duration)){var b=s++;h.type=a,h.start=o,p&&(h.levelkey=p),h.sn=b,h.level=i,h.cc=d,h.urlId=n,h.baseurl=r,h.relurl=(" "+g[3]).slice(1),c(h,u),l.fragments.push(h),u=h,o+=h.duration,h=new Ie}}else if(g[4]){var T=(" "+g[4]).slice(1);u?h.setByteRange(T,u):h.setByteRange(T)}else if(g[5])h.rawProgramDateTime=(" "+g[5]).slice(1),h.tagList.push(["PROGRAM-DATE-TIME",h.rawProgramDateTime]),null===m&&(m=l.fragments.length);else{if(g=g[0].match(Ge),!g){Te.logger.warn("No matches on slow regex match for level playlist!");continue}for(v=1;v<g.length&&void 0===g[v];v++);var S=(" "+g[v+1]).slice(1),A=(" "+g[v+2]).slice(1);switch(g[v]){case"#":h.tagList.push(A?[S,A]:[S]);break;case"PLAYLIST-TYPE":l.type=S.toUpperCase();break;case"MEDIA-SEQUENCE":s=l.startSN=parseInt(S);break;case"TARGETDURATION":l.targetduration=parseFloat(S);break;case"VERSION":l.version=parseInt(S);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":d++,h.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(S);break;case"KEY":var _=S,R=new Fe(_),L=R.enumeratedString("METHOD"),D=R.URI,w=R.hexadecimalInteger("IV");L&&(p=new we(r,D),D&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(L)>=0&&(p.method=L,p.key=null,p.iv=w));break;case"START":var k=new Fe(S),I=k.decimalFloatingPoint("TIME-OFFSET");Object(Ee.isFiniteNumber)(I)&&(l.startTimeOffset=I);break;case"MAP":var O=new Fe(S);h.relurl=O.URI,O.BYTERANGE&&h.setByteRange(O.BYTERANGE),h.baseurl=r,h.level=i,h.type=a,h.sn="initSegment",l.initSegment=h,h=new Ie,h.rawProgramDateTime=l.initSegment.rawProgramDateTime;break;default:Te.logger.warn("line parsed but not handled: "+g)}}}return h=u,h&&!h.relurl&&(l.fragments.pop(),o-=h.duration),l.totalduration=o,l.averagetargetduration=o/l.fragments.length,l.endSN=s-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=d,!l.initSegment&&l.fragments.length&&l.fragments.every(function(e){return je.test(e.relurl)})&&(Te.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),h=new Ie,h.relurl=l.fragments[0].relurl,h.baseurl=r,h.level=i,h.type=a,h.sn="initSegment",l.initSegment=h,l.needSidxRanges=!0),m&&f(l.fragments,m),l},e}(),He=window,Ve=He.performance,We=function(e){function t(t){var r;return r=e.call(this,t,be.default.MANIFEST_LOADING,be.default.LEVEL_LOADING,be.default.AUDIO_TRACK_LOADING,be.default.SUBTITLE_TRACK_LOADING)||this,r.loaders={},r}h(t,e),t.canHaveQualityLevels=function e(t){return t!==Re.AUDIO_TRACK&&t!==Re.SUBTITLE_TRACK},t.mapContextToLevelType=function e(t){var r=t.type;switch(r){case Re.AUDIO_TRACK:return Le.AUDIO;case Re.SUBTITLE_TRACK:return Le.SUBTITLE;default:return Le.MAIN}},t.getResponseUrl=function e(t,r){var i=t.url;return void 0!==i&&0!==i.indexOf("data:")||(i=r.url),i};var r=t.prototype;return r.createInternalLoader=function e(t){var r=this.hls.config,i=r.pLoader,a=r.loader,n=i||a,s=new n(r);return t.loader=s,this.loaders[t.type]=s,s},r.getInternalLoader=function e(t){return this.loaders[t.type]},r.resetInternalLoader=function e(t){this.loaders[t]&&delete this.loaders[t]},r.destroyInternalLoaders=function e(){for(var t in this.loaders){var r=this.loaders[t];r&&r.destroy(),this.resetInternalLoader(t)}},r.destroy=function t(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},r.onManifestLoading=function e(t){this.load({url:t.url,type:Re.MANIFEST,level:0,id:null,responseType:"text"})},r.onLevelLoading=function e(t){this.load({url:t.url,type:Re.LEVEL,level:t.level,id:t.id,responseType:"text"})},r.onAudioTrackLoading=function e(t){this.load({url:t.url,type:Re.AUDIO_TRACK,level:null,id:t.id,responseType:"text"})},r.onSubtitleTrackLoading=function e(t){this.load({url:t.url,type:Re.SUBTITLE_TRACK,level:null,id:t.id,responseType:"text"})},r.load=function e(t){var r=this.hls.config;Te.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var i=this.getInternalLoader(t),a,n,s,o;if(i){var l=i.context;if(l&&l.url===t.url)return Te.logger.trace("playlist request ongoing"),!1;Te.logger.warn("aborting previous loader for type: "+t.type),i.abort()}switch(t.type){case Re.MANIFEST:a=r.manifestLoadingMaxRetry,n=r.manifestLoadingTimeOut,s=r.manifestLoadingRetryDelay,o=r.manifestLoadingMaxRetryTimeout;break;case Re.LEVEL:a=0,o=0,s=0,n=r.levelLoadingTimeOut;break;default:a=r.levelLoadingMaxRetry,n=r.levelLoadingTimeOut,s=r.levelLoadingRetryDelay,o=r.levelLoadingMaxRetryTimeout}i=this.createInternalLoader(t);var d={timeout:n,maxRetry:a,retryDelay:s,maxRetryDelay:o},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return Te.logger.debug("Calling internal loader delegate for URL: "+t.url),i.load(t,d,u),!0},r.loadsuccess=function e(t,r,i,a){if(void 0===a&&(a=null),i.isSidxRequest)return this._handleSidxRequest(t,i),void this._handlePlaylistLoaded(t,r,i,a);if(this.resetInternalLoader(i.type),"string"!=typeof t.data)throw new Error('expected responseType of "text" for PlaylistLoader');var n=t.data;r.tload=Ve.now(),0===n.indexOf("#EXTM3U")?n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(t,r,i,a):this._handleMasterPlaylist(t,r,i,a):this._handleManifestParsingError(t,i,"no EXTM3U delimiter",a)},r.loaderror=function e(t,r,i){void 0===i&&(i=null),this._handleNetworkError(r,i,!1,t)},r.loadtimeout=function e(t,r,i){void 0===i&&(i=null),this._handleNetworkError(r,i,!0)},r._handleMasterPlaylist=function e(r,i,a,n){var s=this.hls,o=r.data,l=t.getResponseUrl(r,a),d=Ke.parseMasterPlaylist(o,l);if(d.length){var u=d.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),f=Ke.parseMasterPlaylistMedia(o,l,"AUDIO",u),c=Ke.parseMasterPlaylistMedia(o,l,"SUBTITLES");if(f.length){var h=!1;f.forEach(function(e){e.url||(h=!0)}),!1===h&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(Te.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),f.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1}))}s.trigger(be.default.MANIFEST_LOADED,{levels:d,audioTracks:f,subtitles:c,url:l,stats:i,networkDetails:n})}else this._handleManifestParsingError(r,a,"no level found in manifest",n)},r._handleTrackOrLevelPlaylist=function e(r,i,a,n){var s=this.hls,o=a.id,l=a.level,d=a.type,u=t.getResponseUrl(r,a),f=Object(Ee.isFiniteNumber)(o)?o:0,c=Object(Ee.isFiniteNumber)(l)?l:f,h=t.mapContextToLevelType(a),g=Ke.parseLevelPlaylist(r.data,u,c,h,f);if(g.tload=i.tload,d===Re.MANIFEST){var v={url:u,details:g};s.trigger(be.default.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:u,stats:i,networkDetails:n})}if(i.tparsed=Ve.now(),g.needSidxRanges){var p=g.initSegment.url;this.load({url:p,isSidxRequest:!0,type:d,level:l,levelDetails:g,id:o,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else a.levelDetails=g,this._handlePlaylistLoaded(r,i,a,n)},r._handleSidxRequest=function e(t,r){if("string"==typeof t.data)throw new Error("sidx request must be made with responseType of array buffer");var i=De.default.parseSegmentIndex(new Uint8Array(t.data));if(i){var a=i.references,n=r.levelDetails;a.forEach(function(e,t){var r=e.info;if(n){var i=n.fragments[t];0===i.byteRange.length&&i.setByteRange(String(1+r.end-r.start)+"@"+String(r.start))}}),n&&n.initSegment.setByteRange(String(i.moovEndOffset)+"@0")}},r._handleManifestParsingError=function e(t,r,i,a){this.hls.trigger(be.default.ERROR,{type:ye.ErrorTypes.NETWORK_ERROR,details:ye.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:t.url,reason:i,networkDetails:a})},r._handleNetworkError=function e(t,r,i,a){var n,s;void 0===i&&(i=!1),void 0===a&&(a=null),Te.logger.info("A network error occured while loading a "+t.type+"-type playlist");var o=this.getInternalLoader(t);switch(t.type){case Re.MANIFEST:n=i?ye.ErrorDetails.MANIFEST_LOAD_TIMEOUT:ye.ErrorDetails.MANIFEST_LOAD_ERROR,s=!0;break;case Re.LEVEL:n=i?ye.ErrorDetails.LEVEL_LOAD_TIMEOUT:ye.ErrorDetails.LEVEL_LOAD_ERROR,s=!1;break;case Re.AUDIO_TRACK:n=i?ye.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ye.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,s=!1;break;default:s=!1}o&&(o.abort(),this.resetInternalLoader(t.type));var l={type:ye.ErrorTypes.NETWORK_ERROR,details:n,fatal:s,url:t.url,loader:o,context:t,networkDetails:r};a&&(l.response=a),this.hls.trigger(be.default.ERROR,l)},r._handlePlaylistLoaded=function e(r,i,a,n){var s=a.type,o=a.level,l=a.id,d=a.levelDetails;if(d&&d.targetduration){var u=t.canHaveQualityLevels(a.type);if(u)this.hls.trigger(be.default.LEVEL_LOADED,{details:d,level:o||0,id:l||0,stats:i,networkDetails:n});else switch(s){case Re.AUDIO_TRACK:this.hls.trigger(be.default.AUDIO_TRACK_LOADED,{details:d,id:l,stats:i,networkDetails:n});break;case Re.SUBTITLE_TRACK:this.hls.trigger(be.default.SUBTITLE_TRACK_LOADED,{details:d,id:l,stats:i,networkDetails:n})}}else this._handleManifestParsingError(r,a,"invalid target duration",n)},t}(_e),Ye=We,ze=function(e){function t(t){var r;return r=e.call(this,t,be.default.FRAG_LOADING)||this,r.loaders={},r}g(t,e);var r=t.prototype;return r.destroy=function t(){var r=this.loaders;for(var i in r){var a=r[i];a&&a.destroy()}this.loaders={},e.prototype.destroy.call(this)},r.onFragLoading=function e(t){var r=t.frag,i=r.type,a=this.loaders,n=this.hls.config,s=n.fLoader,o=n.loader;r.loaded=0;var l=a[i],d,u,f;l&&(Te.logger.warn("abort previous fragment loader for type: "+i),l.abort()),l=a[i]=r.loader=n.fLoader?new s(n):new o(n),d={url:r.url,frag:r,responseType:"arraybuffer",progressData:!1};var c=r.byteRangeStartOffset,h=r.byteRangeEndOffset;Object(Ee.isFiniteNumber)(c)&&Object(Ee.isFiniteNumber)(h)&&(d.rangeStart=c,d.rangeEnd=h),u={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},l.load(d,u,f)},r.loadsuccess=function e(t,r,i,a){void 0===a&&(a=null);var n=t.data,s=i.frag;s.loader=void 0,this.loaders[s.type]=void 0,this.hls.trigger(be.default.FRAG_LOADED,{payload:n,frag:s,stats:r,networkDetails:a})},r.loaderror=function e(t,r,i){void 0===i&&(i=null);var a=r.frag,n=a.loader;n&&n.abort(),this.loaders[a.type]=void 0,this.hls.trigger(be.default.ERROR,{type:ye.ErrorTypes.NETWORK_ERROR,details:ye.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r.frag,response:t,networkDetails:i})},r.loadtimeout=function e(t,r,i){void 0===i&&(i=null);var a=r.frag,n=a.loader;n&&n.abort(),this.loaders[a.type]=void 0,this.hls.trigger(be.default.ERROR,{type:ye.ErrorTypes.NETWORK_ERROR,details:ye.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r.frag,networkDetails:i})},r.loadprogress=function e(t,r,i,a){void 0===a&&(a=null);var n=r.frag;n.loaded=t.loaded,this.hls.trigger(be.default.FRAG_LOAD_PROGRESS,{frag:n,stats:t,networkDetails:a})},t}(_e),Xe=ze,qe=function(e){function t(t){var r;return r=e.call(this,t,be.default.KEY_LOADING)||this,r.loaders={},r.decryptkey=null,r.decrypturl=null,r}v(t,e);var r=t.prototype;return r.destroy=function t(){for(var r in this.loaders){var i=this.loaders[r];i&&i.destroy()}this.loaders={},e.prototype.destroy.call(this)},r.onKeyLoading=function e(t){var r=t.frag,i=r.type,a=this.loaders[i];if(r.decryptdata){var n=r.decryptdata.uri;if(n!==this.decrypturl||null===this.decryptkey){var s=this.hls.config;if(a&&(Te.logger.warn("abort previous key loader for type:"+i),a.abort()),!n)return void Te.logger.warn("key uri is falsy");r.loader=this.loaders[i]=new s.loader(s),this.decrypturl=n,this.decryptkey=null;var o={url:n,frag:r,responseType:"arraybuffer"},l={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.loader.load(o,l,d)}else this.decryptkey&&(r.decryptdata.key=this.decryptkey,this.hls.trigger(be.default.KEY_LOADED,{frag:r}))}else Te.logger.warn("Missing decryption data on fragment in onKeyLoading")},r.loadsuccess=function e(t,r,i){var a=i.frag;a.decryptdata?(this.decryptkey=a.decryptdata.key=new Uint8Array(t.data),a.loader=void 0,delete this.loaders[a.type],this.hls.trigger(be.default.KEY_LOADED,{frag:a})):Te.logger.error("after key load, decryptdata unset")},r.loaderror=function e(t,r){var i=r.frag,a=i.loader;a&&a.abort(),delete this.loaders[i.type],this.hls.trigger(be.default.ERROR,{type:ye.ErrorTypes.NETWORK_ERROR,details:ye.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:i,response:t})},r.loadtimeout=function e(t,r){var i=r.frag,a=i.loader;a&&a.abort(),delete this.loaders[i.type],this.hls.trigger(be.default.ERROR,{type:ye.ErrorTypes.NETWORK_ERROR,details:ye.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},t}(_e),Qe=qe,Je="NOT_LOADED",Ze="APPENDING",$e="PARTIAL",et="OK",tt=function(e){function t(t){var r;return r=e.call(this,t,be.default.BUFFER_APPENDED,be.default.FRAG_BUFFERED,be.default.FRAG_LOADED)||this,r.bufferPadding=.2,r.fragments=Object.create(null),r.timeRanges=Object.create(null),r.config=t.config,r}p(t,e);var r=t.prototype;return r.destroy=function t(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,_e.prototype.destroy.call(this),e.prototype.destroy.call(this)},r.getBufferedFrag=function e(t,r){var i=this.fragments,a=Object.keys(i).filter(function(e){var a=i[e];if(a.body.type!==r)return!1;if(!a.buffered)return!1;var n=a.body;return n.startPTS<=t&&t<=n.endPTS});if(0===a.length)return null;var n=a.pop();return i[n].body},r.detectEvictedFragments=function e(t,r){var i=this,a,n;Object.keys(this.fragments).forEach(function(e){var s=i.fragments[e];if(!0===s.buffered){var o=s.range[t];if(o){a=o.time;for(var l=0;l<a.length;l++)if(n=a[l],!1===i.isTimeBuffered(n.startPTS,n.endPTS,r)){i.removeFragment(s.body);break}}}})},r.detectPartialFragments=function e(t){var r=this,i=this.getFragmentKey(t),a=this.fragments[i];a&&(a.buffered=!0,Object.keys(this.timeRanges).forEach(function(e){if(t.hasElementaryStream(e)){var i=r.timeRanges[e];a.range[e]=r.getBufferedTimes(t.startPTS,t.endPTS,i)}}))},r.getBufferedTimes=function e(t,r,i){for(var a=[],n,s,o=!1,l=0;l<i.length;l++){if(n=i.start(l)-this.bufferPadding,s=i.end(l)+this.bufferPadding,t>=n&&r<=s){a.push({startPTS:Math.max(t,i.start(l)),endPTS:Math.min(r,i.end(l))});break}if(t<s&&r>n)a.push({startPTS:Math.max(t,i.start(l)),endPTS:Math.min(r,i.end(l))}),o=!0;else if(r<=n)break}return{time:a,partial:o}},r.getFragmentKey=function e(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn},r.getPartialFragment=function e(t){var r=this,i,a,n,s=null,o=0;return Object.keys(this.fragments).forEach(function(e){var l=r.fragments[e];r.isPartial(l)&&(a=l.body.startPTS-r.bufferPadding,n=l.body.endPTS+r.bufferPadding,t>=a&&t<=n&&(i=Math.min(t-a,n-t),o<=i&&(s=l.body,o=i)))}),s},r.getState=function e(t){var r=this.getFragmentKey(t),i=this.fragments[r],a=Je;return void 0!==i&&(a=i.buffered?!0===this.isPartial(i)?$e:et:Ze),a},r.isPartial=function e(t){return!0===t.buffered&&(void 0!==t.range.video&&!0===t.range.video.partial||void 0!==t.range.audio&&!0===t.range.audio.partial)},r.isTimeBuffered=function e(t,r,i){for(var a,n,s=0;s<i.length;s++){if(a=i.start(s)-this.bufferPadding,n=i.end(s)+this.bufferPadding,t>=a&&r<=n)return!0;if(r<=a)return!1}return!1},r.onFragLoaded=function e(t){var r=t.frag;Object(Ee.isFiniteNumber)(r.sn)&&!r.bitrateTest&&(this.fragments[this.getFragmentKey(r)]={body:r,range:Object.create(null),buffered:!1})},r.onBufferAppended=function e(t){var r=this;this.timeRanges=t.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var t=r.timeRanges[e];r.detectEvictedFragments(e,t)})},r.onFragBuffered=function e(t){this.detectPartialFragments(t.frag)},r.hasFragment=function e(t){var r=this.getFragmentKey(t);return void 0!==this.fragments[r]},r.removeFragment=function e(t){var r=this.getFragmentKey(t);delete this.fragments[r]},r.removeAllFragments=function e(){this.fragments=Object.create(null)},t}(_e),rt={search:function e(t,r){for(var i=0,a=t.length-1,n=null,s=null;i<=a;){n=(i+a)/2|0,s=t[n];var o=r(s);if(o>0)i=n+1;else{if(!(o<0))return s;a=n-1}}return null}},it=rt,at=function(){function e(){}return e.isBuffered=function e(t,r){try{if(t)for(var i=t.buffered,a=0;a<i.length;a++)if(r>=i.start(a)&&r<=i.end(a))return!0}catch(n){}return!1},e.bufferInfo=function e(t,r,i){try{if(t){var a=t.buffered,n=[],s;for(s=0;s<a.length;s++)n.push({start:a.start(s),end:a.end(s)});return this.bufferedInfo(n,r,i)}}catch(o){}return{len:0,start:r,end:r,nextStart:void 0}},e.bufferedInfo=function e(t,r,i){t.sort(function(e,t){var r=e.start-t.start;return r||t.end-e.end});var a=[];if(i)for(var n=0;n<t.length;n++){var s=a.length;if(s){var o=a[s-1].end;t[n].start-o<i?t[n].end>o&&(a[s-1].end=t[n].end):a.push(t[n])}else a.push(t[n])}else a=t;for(var l=0,d,u=r,f=r,c=0;c<a.length;c++){var h=a[c].start,g=a[c].end;if(r+i>=h&&r<g)u=h,f=g,l=f-r;else if(r+i<h){d=h;break}}return{len:l,start:u,end:f,nextStart:d}},e}(),nt=r("./node_modules/eventemitter3/index.js"),st=r("./node_modules/webworkify-webpack/index.js"),ot=r("./src/demux/demuxer-inline.js"),lt=r("./src/utils/get-self-scope.js"),dt=function(e){function t(){return e.apply(this,arguments)||this}y(t,e);var r=t.prototype;return r.trigger=function e(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];this.emit.apply(this,[t,t].concat(i))},t}(nt.EventEmitter),ut=Object(lt.getSelfScope)(),ft=m()||{isTypeSupported:function e(){return!1}},ct=function(){function e(e,t){var r=this;this.hls=e,this.id=t;var i=this.observer=new dt,a=e.config,n=function t(i,a){a=a||{},a.frag=r.frag,a.id=r.id,e.trigger(i,a)};i.on(be.default.FRAG_DECRYPTED,n),i.on(be.default.FRAG_PARSING_INIT_SEGMENT,n),i.on(be.default.FRAG_PARSING_DATA,n),i.on(be.default.FRAG_PARSED,n),i.on(be.default.ERROR,n),i.on(be.default.FRAG_PARSING_METADATA,n),i.on(be.default.FRAG_PARSING_USERDATA,n),i.on(be.default.INIT_PTS_FOUND,n);var s={mp4:ft.isTypeSupported("video/mp4"),mpeg:ft.isTypeSupported("audio/mpeg"),mp3:ft.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(a.enableWorker&&"undefined"!=typeof Worker){var l;Te.logger.log("demuxing in webworker");try{l=this.w=st(/*! ../demux/demuxer-worker.js */"./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(t){e.trigger(be.default.ERROR,{type:ye.ErrorTypes.OTHER_ERROR,details:ye.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},l.postMessage({cmd:"init",typeSupported:s,vendor:o,id:t,config:JSON.stringify(a)})}catch(d){Te.logger.warn("Error in worker:",d),Te.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),l&&ut.URL.revokeObjectURL(l.objectURL),this.demuxer=new ot.default(i,s,a,o),this.w=void 0}}else this.demuxer=new ot.default(i,s,a,o)}var t=e.prototype;return t.destroy=function e(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var r=this.demuxer;r&&(r.destroy(),this.demuxer=null)}var i=this.observer;i&&(i.removeAllListeners(),this.observer=null)},t.push=function e(t,r,i,a,n,s,o,l){var d=this.w,u=Object(Ee.isFiniteNumber)(n.startPTS)?n.startPTS:n.start,f=n.decryptdata,c=this.frag,h=!(c&&n.cc===c.cc),g=!(c&&n.level===c.level),v=c&&n.sn===c.sn+1,p=!g&&v;if(h&&Te.logger.log(this.id+":discontinuity detected"),g&&Te.logger.log(this.id+":switch detected"),this.frag=n,d)d.postMessage({cmd:"demux",data:t,decryptdata:f,initSegment:r,audioCodec:i,videoCodec:a,timeOffset:u,discontinuity:h,trackSwitch:g,contiguous:p,duration:s,accurateTimeOffset:o,defaultInitPTS:l},t instanceof ArrayBuffer?[t]:[]);else{var m=this.demuxer;m&&m.push(t,f,r,i,a,u,h,g,p,s,o,l)}},t.onWorkerMessage=function e(t){var r=t.data,i=this.hls;switch(r.event){case"init":ut.URL.revokeObjectURL(this.w.objectURL);break;case be.default.FRAG_PARSING_DATA:r.data.data1=new Uint8Array(r.data1),r.data2&&(r.data.data2=new Uint8Array(r.data2));default:r.data=r.data||{},r.data.frag=this.frag,r.data.id=this.id,i.trigger(r.event,r.data)}},e}(),ht=ct,gt={toString:function e(t){for(var r="",i=t.length,a=0;a<i;a++)r+="["+t.start(a).toFixed(3)+","+t.end(a).toFixed(3)+"]";return r}},vt=gt,pt=250,mt=2,yt=.1,Et=.05,bt=function(){function e(e,t,r,i){this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var t=e.prototype;return t.poll=function e(t){var r=this.config,i=this.media,a=this.stalled,n=i.currentTime,s=i.seeking,o=this.seeking&&!s,l=!this.seeking&&s;if(this.seeking=s,n===t){if((l||o)&&(this.stalled=null),!i.paused&&!i.ended&&0!==i.playbackRate&&i.buffered.length){var d=at.bufferInfo(i,n,0),u=d.len>0,f=d.nextStart||0;if(u||f){if(s){var c=d.len>2,h=!f||f-n>2;if(c||h)return;this.moved=!1}if(!this.moved&&this.stalled){var g=Math.max(f,d.start||0)-n;if(g>0&&g<=2)return void this._trySkipBufferHole(null)}var v=self.performance.now();if(null!==a){var p=v-a;!s&&p>=250&&this._reportStall(d.len);var m=at.bufferInfo(i,n,r.maxBufferHole);this._tryFixBufferStall(m,p)}else this.stalled=v}}}else if(this.moved=!0,null!==a){if(this.stallReported){var y=self.performance.now()-a;Te.logger.warn("playback not stuck anymore @"+n+", after "+Math.round(y)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function e(t,r){var i=this.config,a=this.fragmentTracker,n=this.media,s=n.currentTime,o=a.getPartialFragment(s);if(o){var l=this._trySkipBufferHole(o);if(l)return}t.len>i.maxBufferHole&&r>1e3*i.highBufferWatchdogPeriod&&(Te.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function e(t){var r=this.hls,i=this.media,a=this.stallReported;a||(this.stallReported=!0,Te.logger.warn("Playback stalling at @"+i.currentTime+" due to low buffer"),r.trigger(be.default.ERROR,{type:ye.ErrorTypes.MEDIA_ERROR,details:ye.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},t._trySkipBufferHole=function e(t){for(var r=this.config,i=this.hls,a=this.media,n=a.currentTime,s=0,o=0;o<a.buffered.length;o++){var l=a.buffered.start(o);if(n+r.maxBufferHole>=s&&n<l){var d=Math.max(l+.05,a.currentTime+.1);return Te.logger.warn("skipping hole, adjusting currentTime from "+n+" to "+d),this.moved=!0,this.stalled=null,a.currentTime=d,t&&i.trigger(be.default.ERROR,{type:ye.ErrorTypes.MEDIA_ERROR,details:ye.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+d,frag:t}),d}s=a.buffered.end(o)}return 0},t._tryNudgeBuffer=function e(){var t=this.config,r=this.hls,i=this.media,a=i.currentTime,n=(this.nudgeRetry||0)+1;if(this.nudgeRetry=n,n<t.nudgeMaxRetry){var s=a+n*t.nudgeOffset;Te.logger.warn("Nudging 'currentTime' from "+a+" to "+s),i.currentTime=s,r.trigger(be.default.ERROR,{type:ye.ErrorTypes.MEDIA_ERROR,details:ye.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else Te.logger.error("Playhead still not moving while enough data buffered @"+a+" after "+t.nudgeMaxRetry+" nudges"),r.trigger(be.default.ERROR,{type:ye.ErrorTypes.MEDIA_ERROR,details:ye.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}(),Tt=function(e){function t(t){for(var r,i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return r=e.call.apply(e,[this,t].concat(a))||this,r._boundTick=void 0,r._tickTimer=null,r._tickInterval=null,r._tickCallCount=0,r._boundTick=r.tick.bind(B(r)),r}G(t,e);var r=t.prototype;return r.onHandlerDestroying=function e(){this.clearNextTick(),this.clearInterval()},r.hasInterval=function e(){return!!this._tickInterval},r.hasNextTick=function e(){return!!this._tickTimer},r.setInterval=function e(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},r.clearInterval=function e(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},r.clearNextTick=function e(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},r.tick=function e(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},r.doTick=function e(){},t}(_e),St={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},At=function(e){function t(){return e.apply(this,arguments)||this}j(t,e);var r=t.prototype;return r.doTick=function e(){},r.startLoad=function e(){},r.stopLoad=function e(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=St.STOPPED},r._streamEnded=function e(t,r){var i=this.fragCurrent,a=this.fragmentTracker;if(!r.live&&i&&!i.backtracked&&i.sn===r.endSN&&!t.nextStart){var n=a.getState(i);return n===$e||n===et}return!1},r.onMediaSeeking=function e(){var t=this.config,r=this.media,i=this.mediaBuffer,a=this.state,n=r?r.currentTime:null,s=at.bufferInfo(i||r,n,this.config.maxBufferHole);if(Object(Ee.isFiniteNumber)(n)&&Te.logger.log("media seeking to "+n.toFixed(3)),a===St.FRAG_LOADING){var o=this.fragCurrent;if(0===s.len&&o){var l=t.maxFragLookUpTolerance,d=o.start-l,u=o.start+o.duration+l;n<d||n>u?(o.loader&&(Te.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),o.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=St.IDLE):Te.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else a===St.ENDED&&(0===s.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=St.IDLE);r&&(this.lastCurrentTime=n),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=n),this.tick()},r.onMediaEnded=function e(){this.startPosition=this.lastCurrentTime=0},r.onHandlerDestroying=function t(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},r.onHandlerDestroyed=function e(){this.state=St.STOPPED,this.fragmentTracker=null},r.computeLivePosition=function e(t,r){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*r.targetduration;return t+Math.max(0,r.totalduration-i)},t}(Tt),_t=100,Rt=function(e){function t(t,r){var i;return i=e.call(this,t,be.default.MEDIA_ATTACHED,be.default.MEDIA_DETACHING,be.default.MANIFEST_LOADING,be.default.MANIFEST_PARSED,be.default.LEVEL_LOADED,be.default.KEY_LOADED,be.default.FRAG_LOADED,be.default.FRAG_LOAD_EMERGENCY_ABORTED,be.default.FRAG_PARSING_INIT_SEGMENT,be.default.FRAG_PARSING_DATA,be.default.FRAG_PARSED,be.default.ERROR,be.default.AUDIO_TRACK_SWITCHING,be.default.AUDIO_TRACK_SWITCHED,be.default.BUFFER_CREATED,be.default.BUFFER_APPENDED,be.default.BUFFER_FLUSHED)||this,i.fragmentTracker=r,i.config=t.config,i.audioCodecSwap=!1,i._state=St.STOPPED,i.stallReported=!1,i.gapController=null,i.altAudio=!1,i}V(t,e);var r=t.prototype;return r.startLoad=function e(t){if(this.levels){var r=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var a=i.startLevel;-1===a&&(a=0,this.bitrateTest=!0),this.level=i.nextLoadLevel=a,this.loadedmetadata=!1}r>0&&-1===t&&(Te.logger.log("override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r),this.state=St.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=St.STOPPED},r.stopLoad=function t(){this.forceStartLoad=!1,e.prototype.stopLoad.call(this)},r.doTick=function e(){switch(this.state){case St.BUFFER_FLUSHING:this.fragLoadError=0;break;case St.IDLE:this._doTickIdle();break;case St.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=St.IDLE);break;case St.FRAG_LOADING_WAITING_RETRY:var r=window.performance.now(),i=this.retryDate;(!i||r>=i||this.media&&this.media.seeking)&&(Te.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=St.IDLE);break;case St.ERROR:case St.STOPPED:case St.FRAG_LOADING:case St.PARSING:case St.PARSED:case St.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},r._doTickIdle=function e(){var t=this.hls,r=t.config,i=this.media;if(void 0!==this.levelLastLoaded&&(i||!this.startFragRequested&&r.startFragPrefetch)){var a;a=this.loadedmetadata?i.currentTime:this.nextLoadPosition;var n=t.nextLoadLevel,s=this.levels[n];if(s){var o=s.bitrate,l;l=o?Math.max(8*r.maxBufferSize/o,r.maxBufferLength):r.maxBufferLength,l=Math.min(l,r.maxMaxBufferLength);var d=at.bufferInfo(this.mediaBuffer?this.mediaBuffer:i,a,r.maxBufferHole),u=d.len;if(!(u>=l)){Te.logger.trace("buffer length of "+u.toFixed(3)+" is below max of "+l.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=n;var f=s.details;if(!f||f.live&&this.levelLastLoaded!==n)this.state=St.WAITING_LEVEL;else{if(this._streamEnded(d,f)){var c={};return this.altAudio&&(c.type="video"),this.hls.trigger(be.default.BUFFER_EOS,c),void(this.state=St.ENDED)}this._fetchPayloadOrEos(a,d,f)}}}}},r._fetchPayloadOrEos=function e(t,r,i){var a=this.fragPrevious,n=this.level,s=i.fragments,o=s.length;if(0!==o){var l=s[0].start,d=s[o-1].start+s[o-1].duration,u=r.end,f;if(i.initSegment&&!i.initSegment.data)f=i.initSegment;else if(i.live){var c=this.config.initialLiveManifestSize;if(o<c)return void Te.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+c);if(f=this._ensureFragmentAtLivePoint(i,u,l,d,a,s,o),null===f)return}else u<l&&(f=s[0]);f||(f=this._findFragment(l,a,o,s,u,d,i)),f&&(f.encrypted?(Te.logger.log("Loading key for "+f.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n),this._loadKey(f)):(Te.logger.log("Loading "+f.sn+" of ["+i.startSN+" ,"+i.endSN+"],level "+n+", currentTime:"+t.toFixed(3)+",bufferEnd:"+u.toFixed(3)),this._loadFragment(f)))}},r._ensureFragmentAtLivePoint=function e(t,r,i,a,n,s,o){var l=this.hls.config,d=this.media,u,f=void 0!==l.liveMaxLatencyDuration?l.liveMaxLatencyDuration:l.liveMaxLatencyDurationCount*t.targetduration;if(r<Math.max(i-l.maxFragLookUpTolerance,a-f)){var c=this.liveSyncPosition=this.computeLivePosition(i,t);Te.logger.log("buffer end: "+r.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+c.toFixed(3)),r=c,d&&!d.paused&&d.readyState&&d.duration>c&&(d.currentTime=c),this.nextLoadPosition=c}if(t.PTSKnown&&r>a&&d&&d.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(n)if(t.hasProgramDateTime)Te.logger.log("live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),u=F(s,n.endProgramDateTime,l.maxFragLookUpTolerance);else{var h=n.sn+1;if(h>=t.startSN&&h<=t.endSN){var g=s[h-t.startSN];n.cc===g.cc&&(u=g,Te.logger.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=it.search(s,function(e){return n.cc-e.cc}),u&&Te.logger.log("live playlist, switching playlist, load frag with same CC: "+u.sn))}u||(u=s[Math.min(o-1,Math.round(o/2))],Te.logger.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u},r._findFragment=function e(t,r,i,a,n,s,o){var l=this.hls.config,d;if(n<s){var u=n>s-l.maxFragLookUpTolerance?0:l.maxFragLookUpTolerance;d=M(r,a,n,u)}else d=a[i-1];if(d){var f=d.sn-o.startSN,c=r&&d.level===r.level,h=a[f-1],g=a[f+1];if(r&&d.sn===r.sn)if(c&&!d.backtracked)if(d.sn<o.endSN){var v=r.deltaPTS;v&&v>l.maxBufferHole&&r.dropped&&f?(d=h,Te.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(d=g,Te.logger.log("Re-loading fragment with SN: "+d.sn))}else d=null;else d.backtracked&&(g&&g.backtracked?(Te.logger.warn("Already backtracked from fragment "+g.sn+", will not backtrack to fragment "+d.sn+". Loading fragment "+g.sn),d=g):(Te.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),d.dropped=0,h?(d=h,d.backtracked=!0):f&&(d=null)))}return d},r._loadKey=function e(t){this.state=St.KEY_LOADING,this.hls.trigger(be.default.KEY_LOADING,{frag:t})},r._loadFragment=function e(t){var r=this.fragmentTracker.getState(t);this.fragCurrent=t,"initSegment"!==t.sn&&(this.startFragRequested=!0),Object(Ee.isFiniteNumber)(t.sn)&&!t.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),t.backtracked||r===Je||r===$e?(t.autoLevel=this.hls.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.hls.trigger(be.default.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new ht(this.hls,"main")),this.state=St.FRAG_LOADING):r===Ze&&this._reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t)},r.getBufferedFrag=function e(t){return this.fragmentTracker.getBufferedFrag(t,Le.MAIN)},r.followingBufferedFrag=function e(t){return t?this.getBufferedFrag(t.endPTS+.5):null},r._checkFragmentChanged=function e(){var t,r,i=this.media;if(i&&i.readyState&&!1===i.seeking&&(r=i.currentTime,r>this.lastCurrentTime&&(this.lastCurrentTime=r),at.isBuffered(i,r)?t=this.getBufferedFrag(r):at.isBuffered(i,r+.1)&&(t=this.getBufferedFrag(r+.1)),t)){var a=t;if(a!==this.fragPlaying){this.hls.trigger(be.default.FRAG_CHANGED,{frag:a});var n=a.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(be.default.LEVEL_SWITCHED,{level:n}),this.fragPlaying=a}}},r.immediateLevelSwitch=function e(){if(Te.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,r;t?(r=t.paused,t.pause()):r=!0,this.previouslyPaused=r}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.immediateLevelSwitchEnd=function e(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,at.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},r.nextLevelSwitch=function e(){var t=this.media;if(t&&t.readyState){var r,i,a;if(i=this.getBufferedFrag(t.currentTime),i&&i.startPTS>1&&this.flushMainBuffer(0,i.startPTS-1),t.paused)r=0;else{var n=this.hls.nextLoadLevel,s=this.levels[n],o=this.fragLastKbps;r=o&&this.fragCurrent?this.fragCurrent.duration*s.bitrate/(1e3*o)+1:0}if(a=this.getBufferedFrag(t.currentTime+r),a&&(a=this.followingBufferedFrag(a),a)){var l=this.fragCurrent;l&&l.loader&&l.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(a.maxStartPTS,Number.POSITIVE_INFINITY)}}},r.flushMainBuffer=function e(t,r){this.state=St.BUFFER_FLUSHING;var i={startOffset:t,endOffset:r};this.altAudio&&(i.type="video"),this.hls.trigger(be.default.BUFFER_FLUSHING,i)},r.onMediaAttached=function e(t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("seeked",this.onvseeked),r.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition),this.gapController=new bt(i,r,this.fragmentTracker,this.hls)},r.onMediaDetaching=function e(){var t=this.media;t&&t.ended&&(Te.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var r=this.levels;r&&r.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},r.onMediaSeeked=function e(){var t=this.media,r=t?t.currentTime:void 0;Object(Ee.isFiniteNumber)(r)&&Te.logger.log("media seeked to "+r.toFixed(3)),this.tick()},r.onManifestLoading=function e(){Te.logger.log("trigger BUFFER_RESET"),this.hls.trigger(be.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},r.onManifestParsed=function e(t){var r=!1,i=!1,a;t.levels.forEach(function(e){a=e.audioCodec,a&&(-1!==a.indexOf("mp4a.40.2")&&(r=!0),-1!==a.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&Te.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=t.altAudio,this.levels=t.levels,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)},r.onLevelLoaded=function e(t){var r=t.details,i=t.level,a=this.levels[this.levelLastLoaded],n=this.levels[i],s=r.totalduration,o=0;if(Te.logger.log("level "+i+" loaded ["+r.startSN+","+r.endSN+"],duration:"+s),r.live){var l=n.details;l&&r.fragments.length>0?(S(l,r),o=r.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,l),r.PTSKnown&&Object(Ee.isFiniteNumber)(o)?Te.logger.log("live playlist sliding:"+o.toFixed(3)):(Te.logger.log("live playlist - outdated PTS, unknown sliding"),x(this.fragPrevious,a,r))):(Te.logger.log("live playlist - first load, unknown sliding"),r.PTSKnown=!1,x(this.fragPrevious,a,r))}else r.PTSKnown=!1;if(n.details=r,this.levelLastLoaded=i,this.hls.trigger(be.default.LEVEL_UPDATED,{details:r,level:i}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var d=r.startTimeOffset;Object(Ee.isFiniteNumber)(d)?(d<0&&(Te.logger.log("negative start time offset "+d+", count from end of last fragment"),d=o+s+d),Te.logger.log("start time offset found in playlist, adjust startPosition to "+d),this.startPosition=d):r.live?(this.startPosition=this.computeLivePosition(o,r),Te.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===St.WAITING_LEVEL&&(this.state=St.IDLE),this.tick()},r.onKeyLoaded=function e(){this.state===St.KEY_LOADING&&(this.state=St.IDLE,this.tick())},r.onFragLoaded=function e(t){var r=this.fragCurrent,i=this.hls,a=this.levels,n=this.media,s=t.frag;if(this.state===St.FRAG_LOADING&&r&&"main"===s.type&&s.level===r.level&&s.sn===r.sn){var o=t.stats,l=a[r.level],d=l.details;if(this.bitrateTest=!1,this.stats=o,Te.logger.log("Loaded "+r.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+r.level),s.bitrateTest&&i.nextLoadLevel)this.state=St.IDLE,this.startFragRequested=!1,o.tparsed=o.tbuffered=window.performance.now(),i.trigger(be.default.FRAG_BUFFERED,{stats:o,frag:r,id:"main"}),this.tick();else if("initSegment"===s.sn)this.state=St.IDLE,o.tparsed=o.tbuffered=window.performance.now(),d.initSegment.data=t.payload,i.trigger(be.default.FRAG_BUFFERED,{stats:o,frag:r,id:"main"}),this.tick();else{Te.logger.log("Parsing "+r.sn+" of ["+d.startSN+" ,"+d.endSN+"],level "+r.level+", cc "+r.cc),this.state=St.PARSING,this.pendingBuffering=!0,this.appended=!1,s.bitrateTest&&(s.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:s}));var u=!(n&&n.seeking)&&(d.PTSKnown||!d.live),f=d.initSegment?d.initSegment.data:[],c=this._getAudioCodec(l),h=this.demuxer=this.demuxer||new ht(this.hls,"main");h.push(t.payload,f,c,l.videoCodec,r,d.totalduration,u)}}this.fragLoadError=0},r.onFragParsingInitSegment=function e(t){var r=this.fragCurrent,i=t.frag;if(r&&"main"===t.id&&i.sn===r.sn&&i.level===r.level&&this.state===St.PARSING){var a=t.tracks,n,s;if(a.audio&&this.altAudio&&delete a.audio,s=a.audio,s){var o=this.levels[this.level].audioCodec,l=navigator.userAgent.toLowerCase();o&&this.audioCodecSwap&&(Te.logger.log("swapping playlist audio codec"),o=-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==s.metadata.channelCount&&-1===l.indexOf("firefox")&&(o="mp4a.40.5"),-1!==l.indexOf("android")&&"audio/mpeg"!==s.container&&(o="mp4a.40.2",Te.logger.log("Android: force audio codec to "+o)),s.levelCodec=o,s.id=t.id}for(n in s=a.video,s&&(s.levelCodec=this.levels[this.level].videoCodec,s.id=t.id),this.hls.trigger(be.default.BUFFER_CODECS,a),a){s=a[n],Te.logger.log("main track:"+n+",container:"+s.container+",codecs[level/parsed]=["+s.levelCodec+"/"+s.codec+"]");var d=s.initSegment;d&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(be.default.BUFFER_APPENDING,{type:n,data:d,parent:"main",content:"initSegment"}))}this.tick()}},r.onFragParsingData=function e(t){var r=this,i=this.fragCurrent,a=t.frag;if(i&&"main"===t.id&&a.sn===i.sn&&a.level===i.level&&("audio"!==t.type||!this.altAudio)&&this.state===St.PARSING){var n=this.levels[this.level],s=i;if(Object(Ee.isFiniteNumber)(t.endPTS)||(t.endPTS=t.startPTS+i.duration,t.endDTS=t.startDTS+i.duration),!0===t.hasAudio&&s.addElementaryStream(ke.AUDIO),!0===t.hasVideo&&s.addElementaryStream(ke.VIDEO),Te.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(s.dropped=t.dropped,s.dropped)if(s.backtracked)Te.logger.warn("Already backtracked on this fragment, appending with the gap",s.sn);else{var o=n.details;if(!o||s.sn!==o.startSN)return Te.logger.warn("missing video frame(s), backtracking fragment",s.sn),this.fragmentTracker.removeFragment(s),s.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=St.IDLE,this.fragPrevious=s,void this.tick();Te.logger.warn("missing video frame(s) on first frag, appending with gap",s.sn)}else s.backtracked=!1;var l=T(n.details,s,t.startPTS,t.endPTS,t.startDTS,t.endDTS),d=this.hls;d.trigger(be.default.LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:l,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(e){e&&e.length&&r.state===St.PARSING&&(r.appended=!0,r.pendingBuffering=!0,d.trigger(be.default.BUFFER_APPENDING,{type:t.type,data:e,parent:"main",content:"data"}))}),this.tick()}},r.onFragParsed=function e(t){var r=this.fragCurrent,i=t.frag;r&&"main"===t.id&&i.sn===r.sn&&i.level===r.level&&this.state===St.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=St.PARSED,this._checkAppendedParsed())},r.onAudioTrackSwitching=function e(t){var r=!!t.url,i=t.id;if(!r){if(this.mediaBuffer!==this.media){Te.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;a.loader&&(Te.logger.log("switching to main audio track, cancel main fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=St.IDLE}var n=this.hls;n.trigger(be.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),n.trigger(be.default.AUDIO_TRACK_SWITCHED,{id:i}),this.altAudio=!1}},r.onAudioTrackSwitched=function e(t){var r=t.id,i=!!this.hls.audioTracks[r].url;if(i){var a=this.videoBuffer;a&&this.mediaBuffer!==a&&(Te.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=a)}this.altAudio=i,this.tick()},r.onBufferCreated=function e(t){var r=t.tracks,i,a,n=!1;for(var s in r){var o=r[s];"main"===o.id?(a=s,i=o,"video"===s&&(this.videoBuffer=r[s].buffer)):n=!0}n&&i?(Te.logger.log("alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},r.onBufferAppended=function e(t){if("main"===t.parent){var r=this.state;r!==St.PARSING&&r!==St.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},r._checkAppendedParsed=function e(){if(!(this.state!==St.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var r=this.mediaBuffer?this.mediaBuffer:this.media;Te.logger.log("main buffered : "+vt.toString(r.buffered)),this.fragPrevious=t;var i=this.stats;i.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(be.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.state=St.IDLE}this.tick()}},r.onError=function e(t){var r=t.frag||this.fragCurrent;if(!r||"main"===r.type){var i=!!this.media&&at.isBuffered(this.media,this.media.currentTime)&&at.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case ye.ErrorDetails.FRAG_LOAD_ERROR:case ye.ErrorDetails.FRAG_LOAD_TIMEOUT:case ye.ErrorDetails.KEY_LOAD_ERROR:case ye.ErrorDetails.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var a=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);Te.logger.warn("mediaController: frag loading failed, retry in "+a+" ms"),this.retryDate=window.performance.now()+a,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=St.FRAG_LOADING_WAITING_RETRY}else Te.logger.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=St.ERROR;break;case ye.ErrorDetails.LEVEL_LOAD_ERROR:case ye.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==St.ERROR&&(t.fatal?(this.state=St.ERROR,Te.logger.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==St.WAITING_LEVEL||(this.state=St.IDLE));break;case ye.ErrorDetails.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==St.PARSING&&this.state!==St.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=St.IDLE):(Te.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},r._reduceMaxBufferLength=function e(t){var r=this.config;return r.maxMaxBufferLength>=t&&(r.maxMaxBufferLength/=2,Te.logger.warn("main:reduce max buffer length to "+r.maxMaxBufferLength+"s"),!0)},r._checkBuffer=function e(){var t=this.media;if(t&&0!==t.readyState){var r=this.mediaBuffer?this.mediaBuffer:t,i=r.buffered;!this.loadedmetadata&&i.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,i)}},r.onFragLoadEmergencyAborted=function e(){this.state=St.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},r.onBufferFlushed=function e(){var t=this.mediaBuffer?this.mediaBuffer:this.media;t&&this.fragmentTracker.detectEvictedFragments(ke.VIDEO,t.buffered),this.state=St.IDLE,this.fragPrevious=null},r.swapAudioCodec=function e(){this.audioCodecSwap=!this.audioCodecSwap},r._seekToStartPos=function e(){var t=this.media,r=t.currentTime,i=t.seeking?r:this.startPosition;r!==i&&i>=0&&(Te.logger.log("target start position not buffered, seek to buffered.start(0) "+i+" from current time "+r+" "),t.currentTime=i)},r._getAudioCodec=function e(t){var r=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&(Te.logger.log("swapping playlist audio codec"),r&&(r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),r},H(t,[{key:"state",set:function e(t){if(this.state!==t){var r=this.state;this._state=t,Te.logger.log("main stream-controller: "+r+"->"+t),this.hls.trigger(be.default.STREAM_STATE_TRANSITION,{previousState:r,nextState:t})}},get:function e(){return this._state}},{key:"currentLevel",get:function e(){var t=this.media;if(t){var r=this.getBufferedFrag(t.currentTime);if(r)return r.level}return-1}},{key:"nextBufferedFrag",get:function e(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function e(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function e(){return this._liveSyncPosition},set:function e(t){this._liveSyncPosition=t}}]),t}(At),Lt=Rt,Dt=window,wt=Dt.performance,kt,It=function(e){function t(t){var r;return r=e.call(this,t,be.default.MANIFEST_LOADED,be.default.LEVEL_LOADED,be.default.AUDIO_TRACK_SWITCHED,be.default.FRAG_LOADED,be.default.ERROR)||this,r.canload=!1,r.currentLevelIndex=null,r.manualLevelIndex=-1,r.timer=null,kt=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),r}z(t,e);var r=t.prototype;return r.onHandlerDestroying=function e(){this.clearTimer(),this.manualLevelIndex=-1},r.clearTimer=function e(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},r.startLoad=function e(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},r.stopLoad=function e(){this.canload=!1},r.onManifestLoaded=function e(t){var r=[],i=[],a,n={},s=null,o=!1,l=!1;if(t.levels.forEach(function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,o=o||!!e.videoCodec,l=l||!!e.audioCodec,kt&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),s=n[e.bitrate],s?s.url.push(e.url):(e.url=[e.url],e.urlId=0,n[e.bitrate]=e,r.push(e)),t&&(t.AUDIO&&(l=!0,E(s||e,"audio",t.AUDIO)),t.SUBTITLES&&E(s||e,"text",t.SUBTITLES))}),o&&l&&(r=r.filter(function(e){var t=e.videoCodec;return!!t})),r=r.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||u(t,"audio"))&&(!r||u(r,"video"))}),t.audioTracks&&(i=t.audioTracks.filter(function(e){return!e.audioCodec||u(e.audioCodec,"audio")}),i.forEach(function(e,t){e.id=t})),r.length>0){a=r[0].bitrate,r.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=r;for(var d=0;d<r.length;d++)if(r[d].bitrate===a){this._firstLevel=d,Te.logger.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+a);break}this.hls.trigger(be.default.MANIFEST_PARSED,{levels:r,audioTracks:i,firstLevel:this._firstLevel,stats:t.stats,audio:l,video:o,altAudio:i.some(function(e){return!!e.url})})}else this.hls.trigger(be.default.ERROR,{type:ye.ErrorTypes.MEDIA_ERROR,details:ye.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},r.setLevelInternal=function e(t){var r=this._levels,i=this.hls;if(t>=0&&t<r.length){if(this.clearTimer(),this.currentLevelIndex!==t){Te.logger.log("switching to level "+t),this.currentLevelIndex=t;var a=r[t];a.level=t,i.trigger(be.default.LEVEL_SWITCHING,a)}var n=r[t],s=n.details;if(!s||s.live){var o=n.urlId;i.trigger(be.default.LEVEL_LOADING,{url:n.url[o],level:t,id:o})}}else i.trigger(be.default.ERROR,{type:ye.ErrorTypes.OTHER_ERROR,details:ye.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},r.onError=function e(t){if(t.fatal)t.type===ye.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var r=!1,i=!1,a;switch(t.details){case ye.ErrorDetails.FRAG_LOAD_ERROR:case ye.ErrorDetails.FRAG_LOAD_TIMEOUT:case ye.ErrorDetails.KEY_LOAD_ERROR:case ye.ErrorDetails.KEY_LOAD_TIMEOUT:a=t.frag.level,i=!0;break;case ye.ErrorDetails.LEVEL_LOAD_ERROR:case ye.ErrorDetails.LEVEL_LOAD_TIMEOUT:a=t.context.level,r=!0;break;case ye.ErrorDetails.REMUX_ALLOC_ERROR:a=t.level,r=!0}void 0!==a&&this.recoverLevel(t,a,r,i)}},r.recoverLevel=function e(t,r,i,a){var n=this,s=this.hls.config,o=t.details,l=this._levels[r],d,u,f;if(l.loadError++,l.fragmentError=a,i){if(!(this.levelRetryCount+1<=s.levelLoadingMaxRetry))return Te.logger.error("level controller, cannot recover from "+o+" error"),this.currentLevelIndex=null,this.clearTimer(),void(t.fatal=!0);u=Math.min(Math.pow(2,this.levelRetryCount)*s.levelLoadingRetryDelay,s.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return n.loadLevel()},u),t.levelRetry=!0,this.levelRetryCount++,Te.logger.warn("level controller, "+o+", retry in "+u+" ms, current retry count is "+this.levelRetryCount)}(i||a)&&(d=l.url.length,d>1&&l.loadError<d?(l.urlId=(l.urlId+1)%d,l.details=void 0,Te.logger.warn("level controller, "+o+" for level "+r+": switching to redundant URL-id "+l.urlId)):-1===this.manualLevelIndex?(f=0===r?this._levels.length-1:r-1,Te.logger.warn("level controller, "+o+": switch to "+f),this.hls.nextAutoLevel=this.currentLevelIndex=f):a&&(Te.logger.warn("level controller, "+o+": reload a fragment"),this.currentLevelIndex=null))},r.onFragLoaded=function e(t){var r=t.frag;if(void 0!==r&&"main"===r.type){var i=this._levels[r.level];void 0!==i&&(i.fragmentError=!1,i.loadError=0,this.levelRetryCount=0)}},r.onLevelLoaded=function e(t){var r=this,i=t.level,a=t.details;if(i===this.currentLevelIndex){var n=this._levels[i];if(n.fragmentError||(n.loadError=0,this.levelRetryCount=0),a.live){var s=L(n.details,a,t.stats.trequest);Te.logger.log("live playlist, reload in "+Math.round(s)+" ms"),this.timer=setTimeout(function(){return r.loadLevel()},s)}else this.clearTimer()}},r.onAudioTrackSwitched=function e(t){var r=this.hls.audioTracks[t.id].groupId,i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){for(var a=-1,n=0;n<i.audioGroupIds.length;n++)if(i.audioGroupIds[n]===r){a=n;break}a!==i.urlId&&(i.urlId=a,this.startLoad())}},r.loadLevel=function e(){if(Te.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var t=this._levels[this.currentLevelIndex];if("object"==typeof t&&t.url.length>0){var r=this.currentLevelIndex,i=t.urlId,a=t.url[i];Te.logger.log("Attempt loading level index "+r+" with URL-id "+i),this.hls.trigger(be.default.LEVEL_LOADING,{url:a,level:r,id:i})}}},Y(t,[{key:"levels",get:function e(){return this._levels}},{key:"level",get:function e(){return this.currentLevelIndex},set:function e(t){var r=this._levels;r&&(t=Math.min(t,r.length-1),this.currentLevelIndex===t&&r[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function e(){return this.manualLevelIndex},set:function e(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function e(){return this._firstLevel},set:function e(t){this._firstLevel=t}},{key:"startLevel",get:function e(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function e(t){this._startLevel=t}},{key:"nextLoadLevel",get:function e(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function e(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),t}(_e),Ot=r("./src/demux/id3.js"),xt=function(e){function t(t){var r;return r=e.call(this,t,be.default.MEDIA_ATTACHED,be.default.MEDIA_DETACHING,be.default.FRAG_PARSING_METADATA,be.default.LIVE_BACK_BUFFER_REACHED)||this,r.id3Track=void 0,r.media=void 0,r}J(t,e);var r=t.prototype;return r.destroy=function e(){_e.prototype.destroy.call(this)},r.onMediaAttached=function e(t){this.media=t.media,this.media},r.onMediaDetaching=function e(){q(this.id3Track),this.id3Track=void 0,this.media=void 0},r.getID3Track=function e(t){for(var r=0;r<t.length;r++){var i=t[r];if("metadata"===i.kind&&"id3"===i.label)return X(i,this.media),i}return this.media.addTextTrack("metadata","id3")},r.onFragParsingMetadata=function e(t){var r=t.frag,i=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var a=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0;n<i.length;n++){var s=Ot.default.getID3Frames(i[n].data);if(s){var o=i[n].pts,l=n<i.length-1?i[n+1].pts:r.endPTS;o===l?l+=1e-4:o>l&&(Te.logger.warn("detected an id3 sample with endTime < startTime, adjusting endTime to (startTime + 0.25)"),l=o+.25);for(var d=0;d<s.length;d++){var u=s[d];if(!Ot.default.isTimeStampFrame(u)){var f=new a(o,l,"");f.value=u,this.id3Track.addCue(f)}}}}},r.onLiveBackBufferReached=function e(t){var r=t.bufferEnd,i=this.id3Track;if(i&&i.cues&&i.cues.length){var a=Q(i.cues,r);if(a)for(;i.cues[0]!==a;)i.removeCue(i.cues[0])}},t}(_e),Pt=xt,Ct=function(){function e(e){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var t=e.prototype;return t.sample=function e(t,r){var i=Math.pow(this.alpha_,t);this.estimate_=r*(1-i)+i*this.estimate_,this.totalWeight_+=t},t.getTotalWeight=function e(){return this.totalWeight_},t.getEstimate=function e(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},e}(),Ft=Ct,Mt=function(){function e(e,t,r,i){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=e,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ft(t),this.fast_=new Ft(r)}var t=e.prototype;return t.sample=function e(t,r){t=Math.max(t,this.minDelayMs_);var i=8*r,a=t/1e3,n=i/a;this.fast_.sample(a,n),this.slow_.sample(a,n)},t.canEstimate=function e(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},t.getEstimate=function e(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function e(){},e}(),Nt=Mt,Ut=window,Bt=Ut.performance,Gt=function(e){function t(t){var r;return r=e.call(this,t,be.default.FRAG_LOADING,be.default.FRAG_LOADED,be.default.FRAG_BUFFERED,be.default.ERROR)||this,r.lastLoadedFragLevel=0,r._nextAutoLevel=-1,r.hls=t,r.timer=null,r._bwEstimator=null,r.onCheck=r._abandonRulesCheck.bind(te(r)),r}re(t,e);var r=t.prototype;return r.destroy=function e(){this.clearTimer(),_e.prototype.destroy.call(this)},r.onFragLoading=function e(t){var r=t.frag;if("main"===r.type&&(this.timer||(this.fragCurrent=r,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var i=this.hls,a=i.config,n=r.level,s=i.levels[n].details.live,o,l;s?(o=a.abrEwmaFastLive,l=a.abrEwmaSlowLive):(o=a.abrEwmaFastVoD,l=a.abrEwmaSlowVoD),this._bwEstimator=new Nt(i,l,o,a.abrEwmaDefaultEstimate)}},r._abandonRulesCheck=function e(){var t=this.hls,r=t.media,i=this.fragCurrent;if(i){var a=i.loader,n=t.minAutoLevel;if(!a||a.stats&&a.stats.aborted)return Te.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var s=a.stats;if(r&&s&&(!r.paused&&0!==r.playbackRate||!r.readyState)&&i.autoLevel&&i.level){var o=Bt.now()-s.trequest,l=Math.abs(r.playbackRate);if(o>500*i.duration/l){var d=t.levels,u=Math.max(1,s.bw?s.bw/8:1e3*s.loaded/o),f=d[i.level],c=f.realBitrate?Math.max(f.realBitrate,f.bitrate):f.bitrate,h=s.total?s.total:Math.max(s.loaded,Math.round(i.duration*c/8)),g=r.currentTime,v=(h-s.loaded)/u,p=(at.bufferInfo(r,g,t.config.maxBufferHole).end-g)/l;if(p<2*i.duration/l&&v>p){var m,y;for(y=i.level-1;y>n;y--){var E=d[y].realBitrate?Math.max(d[y].realBitrate,d[y].bitrate):d[y].bitrate,b=i.duration*E/(6.4*u);if(b<p)break}void 0<v&&(Te.logger.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(i.level-1)+"];bufferStarvationDelay:"+(void 0).toFixed(1)+"<"+v.toFixed(1)+":"+p.toFixed(1)),t.nextLoadLevel=y,this._bwEstimator.sample(o,s.loaded),a.abort(),this.clearTimer(),t.trigger(be.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,stats:s}))}}}}},r.onFragLoaded=function e(t){var r=t.frag;if("main"===r.type&&Object(Ee.isFiniteNumber)(r.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=this.hls.levels[r.level],a=(i.loaded?i.loaded.bytes:0)+t.stats.loaded,n=(i.loaded?i.loaded.duration:0)+t.frag.duration;i.loaded={bytes:a,duration:n},i.realBitrate=Math.round(8*a/n)}if(t.frag.bitrateTest){var s=t.stats;s.tparsed=s.tbuffered=s.tload,this.onFragBuffered(t)}}},r.onFragBuffered=function e(t){var r=t.stats,i=t.frag;if(!0!==r.aborted&&"main"===i.type&&Object(Ee.isFiniteNumber)(i.sn)&&(!i.bitrateTest||r.tload===r.tbuffered)){var a=r.tparsed-r.trequest;Te.logger.log("latency/loading/parsing/append/kbps:"+Math.round(r.tfirst-r.trequest)+"/"+Math.round(r.tload-r.tfirst)+"/"+Math.round(r.tparsed-r.tload)+"/"+Math.round(r.tbuffered-r.tparsed)+"/"+Math.round(8*r.loaded/(r.tbuffered-r.trequest))),this._bwEstimator.sample(a,r.loaded),r.bwEstimate=this._bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},r.onError=function e(t){switch(t.details){case ye.ErrorDetails.FRAG_LOAD_ERROR:case ye.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},r.clearTimer=function e(){clearInterval(this.timer),this.timer=null},r._findBestLevel=function e(t,r,i,a,n,s,o,l,d){for(var u=n;u>=a;u--){var f=d[u];if(f){var c=f.details,h=c?c.totalduration/c.fragments.length:r,g=!!c&&c.live,v=void 0;v=u<=t?o*i:l*i;var p=d[u].realBitrate?Math.max(d[u].realBitrate,d[u].bitrate):d[u].bitrate,m=p*h/v;if(Te.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(v)+"/"+p+"/"+h+"/"+s+"/"+m),v>p&&(!m||g&&!this.bitrateTestDelay||m<s))return u}}return-1},ee(t,[{key:"nextAutoLevel",get:function e(){var t=this._nextAutoLevel,r=this._bwEstimator;if(!(-1===t||r&&r.canEstimate()))return t;var i=this._nextABRAutoLevel;return-1!==t&&(i=Math.min(t,i)),i},set:function e(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function e(){var t=this.hls,r=t.maxAutoLevel,i=t.levels,a=t.config,n=t.minAutoLevel,s=t.media,o=this.lastLoadedFragLevel,l=this.fragCurrent?this.fragCurrent.duration:0,d=s?s.currentTime:0,u=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,f=this._bwEstimator?this._bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,c=(at.bufferInfo(s,d,a.maxBufferHole).end-d)/u,h=this._findBestLevel(o,l,f,n,r,c,a.abrBandWidthFactor,a.abrBandWidthUpFactor,i);if(h>=0)return h;Te.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=l?Math.min(l,a.maxStarvationDelay):a.maxStarvationDelay,v=a.abrBandWidthFactor,p=a.abrBandWidthUpFactor;if(0===c){var m=this.bitrateTestDelay;if(m){var y=l?Math.min(l,a.maxLoadingDelay):a.maxLoadingDelay;g=y-m,Te.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),v=p=1}}return h=this._findBestLevel(o,l,f,n,r,c+g,v,p,i),Math.max(h,0)}}]),t}(_e),jt=Gt,Kt=m(),Ht=function(e){function t(t){var r;return r=e.call(this,t,be.default.MEDIA_ATTACHING,be.default.MEDIA_DETACHING,be.default.MANIFEST_PARSED,be.default.BUFFER_RESET,be.default.BUFFER_APPENDING,be.default.BUFFER_CODECS,be.default.BUFFER_EOS,be.default.BUFFER_FLUSHING,be.default.LEVEL_PTS_UPDATED,be.default.LEVEL_UPDATED)||this,r._msDuration=null,r._levelDuration=null,r._levelTargetDuration=10,r._live=null,r._objectUrl=null,r._needsFlush=!1,r._needsEos=!1,r.config=void 0,r.audioTimestampOffset=void 0,r.bufferCodecEventsExpected=0,r._bufferCodecEventsTotal=0,r.media=null,r.mediaSource=null,r.segments=[],r.parent=void 0,r.appending=!1,r.appended=0,r.appendError=0,r.flushBufferCounter=0,r.tracks={},r.pendingTracks={},r.sourceBuffer={},r.flushRange=[],r._onMediaSourceOpen=function(){Te.logger.log("media source opened"),r.hls.trigger(be.default.MEDIA_ATTACHED,{media:r.media});var e=r.mediaSource;e&&e.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},r._onMediaSourceClose=function(){Te.logger.log("media source closed")},r._onMediaSourceEnded=function(){Te.logger.log("media source ended")},r._onSBUpdateEnd=function(){if(r.audioTimestampOffset&&r.sourceBuffer.audio){var e=r.sourceBuffer.audio;Te.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+r.audioTimestampOffset),e.timestampOffset=r.audioTimestampOffset,delete r.audioTimestampOffset}r._needsFlush&&r.doFlush(),r._needsEos&&r.checkEos(),r.appending=!1;var t=r.parent,i=r.segments.reduce(function(e,r){return r.parent===t?e+1:e},0),a={},n=r.sourceBuffer;for(var s in n){var o=n[s];if(!o)throw Error("handling source buffer update end error: source buffer for "+s+" uninitilized and unable to update buffered TimeRanges.");a[s]=o.buffered}r.hls.trigger(be.default.BUFFER_APPENDED,{parent:t,pending:i,timeRanges:a}),r._needsFlush||r.doAppending(),r.updateMediaElementDuration(),0===i&&r.flushLiveBackBuffer()},r._onSBUpdateError=function(e){Te.logger.error("sourceBuffer error:",e),r.hls.trigger(be.default.ERROR,{type:ye.ErrorTypes.MEDIA_ERROR,details:ye.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},r.config=t.config,r}ie(t,e);var r=t.prototype;return r.destroy=function e(){_e.prototype.destroy.call(this)},r.onLevelPtsUpdated=function e(t){var r=t.type,i=this.tracks.audio;if("audio"===r&&i&&"audio/mpeg"===i.container){var a=this.sourceBuffer.audio;if(!a)throw Error("Level PTS Updated and source buffer for audio uninitalized");var n=Math.abs(a.timestampOffset-t.start);if(n>.1){var s=a.updating;try{a.abort()}catch(o){Te.logger.warn("can not abort audio buffer: "+o)}s?this.audioTimestampOffset=t.start:(Te.logger.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+t.start),a.timestampOffset=t.start)}}},r.onManifestParsed=function e(t){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t.altAudio?2:1,Te.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},r.onMediaAttaching=function e(t){var r=this.media=t.media;if(r&&Kt){var i=this.mediaSource=new Kt;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=window.URL.createObjectURL(i),this._objectUrl=r.src}},r.onMediaDetaching=function e(){Te.logger.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(r){Te.logger.warn("onMediaDetaching:"+r.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):Te.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(be.default.MEDIA_DETACHED)},r.checkPendingTracks=function e(){var t=this.bufferCodecEventsExpected,r=this.pendingTracks,i=Object.keys(r).length;(i&&!t||2===i)&&(this.createSourceBuffers(r),this.pendingTracks={},this.doAppending())},r.onBufferReset=function e(){var t=this.sourceBuffer;for(var r in t){var i=t[r];try{i&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(i),i.removeEventListener("updateend",this._onSBUpdateEnd),i.removeEventListener("error",this._onSBUpdateError))}catch(a){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},r.onBufferCodecs=function e(t){var r=this;Object.keys(this.sourceBuffer).length||(Object.keys(t).forEach(function(e){r.pendingTracks[e]=t[e]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},r.createSourceBuffers=function e(t){var r=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(var a in t)if(!r[a]){var n=t[a];if(!n)throw Error("source buffer exists for track "+a+", however track does not");var s=n.levelCodec||n.codec,o=n.container+";codecs="+s;Te.logger.log("creating sourceBuffer("+o+")");try{var l=r[a]=i.addSourceBuffer(o);l.addEventListener("updateend",this._onSBUpdateEnd),l.addEventListener("error",this._onSBUpdateError),this.tracks[a]={buffer:l,codec:s,id:n.id,container:n.container,levelCodec:n.levelCodec}}catch(d){Te.logger.error("error while trying to add sourceBuffer:"+d.message),this.hls.trigger(be.default.ERROR,{type:ye.ErrorTypes.MEDIA_ERROR,details:ye.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:d,mimeType:o})}}this.hls.trigger(be.default.BUFFER_CREATED,{tracks:this.tracks})},r.onBufferAppending=function e(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},r.onBufferEos=function e(t){for(var r in this.sourceBuffer)if(!t.type||t.type===r){var i=this.sourceBuffer[r];i&&!i.ended&&(i.ended=!0,Te.logger.log(r+" sourceBuffer now EOS"))}this.checkEos()},r.checkEos=function e(){var t=this.sourceBuffer,r=this.mediaSource;if(r&&"open"===r.readyState){for(var i in t){var a=t[i];if(a){if(!a.ended)return;if(a.updating)return void(this._needsEos=!0)}}Te.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{r.endOfStream()}catch(n){Te.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},r.onBufferFlushing=function e(t){t.type?this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}):(this.flushRange.push({start:t.startOffset,end:t.endOffset,type:"video"}),this.flushRange.push({start:t.startOffset,end:t.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},r.flushLiveBackBuffer=function e(){if(this._live){var t=this.config.liveBackBufferLength;if(isFinite(t)&&!(t<0))if(this.media)for(var r=this.media.currentTime,i=this.sourceBuffer,a=Object.keys(i),n=r-Math.max(t,this._levelTargetDuration),s=a.length-1;s>=0;s--){var o=a[s],l=i[o];if(l){var d=l.buffered;d.length>0&&n>d.start(0)&&this.removeBufferRange(o,l,0,n)&&this.hls.trigger(be.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n})}}else Te.logger.error("flushLiveBackBuffer called without attaching media")}},r.onLevelUpdated=function e(t){var r=t.details;r.fragments.length>0&&(this._levelDuration=r.totalduration+r.fragments[0].start,this._levelTargetDuration=r.averagetargetduration||r.targetduration||10,this._live=r.live,this.updateMediaElementDuration())},r.updateMediaElementDuration=function e(){var t=this.config,r;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var i in this.sourceBuffer){var a=this.sourceBuffer[i];if(a&&!0===a.updating)return}r=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(Te.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>r||!Object(Ee.isFiniteNumber)(r))&&(Te.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},r.doFlush=function e(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var r=0,i=this.sourceBuffer;try{for(var a in i){var n=i[a];n&&(r+=n.buffered.length)}}catch(s){Te.logger.error("error while accessing sourceBuffer.buffered")}this.appended=r,this.hls.trigger(be.default.BUFFER_FLUSHED)}},r.doAppending=function e(){var t=this.config,r=this.hls,i=this.segments,a=this.sourceBuffer;if(Object.keys(a).length){if(!this.media||this.media.error)return this.segments=[],void Te.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var n=i.shift();if(n)try{var s=a[n.type];if(!s)return void this._onSBUpdateEnd();if(s.updating)return void i.unshift(n);s.ended=!1,this.parent=n.parent,s.appendBuffer(n.data),this.appendError=0,this.appended++,this.appending=!0}catch(l){Te.logger.error("error while trying to append buffer:"+l.message),i.unshift(n);var o={type:ye.ErrorTypes.MEDIA_ERROR,parent:n.parent,details:"",fatal:!1};22===l.code?(this.segments=[],o.details=ye.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,o.details=ye.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>t.appendErrorMaxRetry&&(Te.logger.log("fail "+t.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],o.fatal=!0)),r.trigger(be.default.ERROR,o)}}}},r.flushBuffer=function e(t,r,i){var a=this.sourceBuffer;if(!Object.keys(a).length)return!0;var n="null";if(this.media&&(n=this.media.currentTime.toFixed(3)),Te.logger.log("flushBuffer,pos/start/end: "+n+"/"+t+"/"+r),this.flushBufferCounter>=this.appended)return Te.logger.warn("abort flushing too many retries"),!0;var s=a[i];if(s){if(s.ended=!1,s.updating)return Te.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(i,s,t,r))return this.flushBufferCounter++,!1}return Te.logger.log("buffer flushed"),!0},r.removeBufferRange=function e(t,r,i,a){try{for(var n=0;n<r.buffered.length;n++){var s=r.buffered.start(n),o=r.buffered.end(n),l=Math.max(s,i),d=Math.min(o,a);if(Math.min(d,o)-l>.5){var u="null";return this.media&&(u=this.media.currentTime.toString()),Te.logger.log("sb remove "+t+" ["+l+","+d+"], of ["+s+","+o+"], pos:"+u),r.remove(l,d),!0}}}catch(f){Te.logger.warn("removeBufferRange failed",f)}return!1},t}(_e),Vt=Ht,Wt=function(e){function t(t){var r;return r=e.call(this,t,be.default.FPS_DROP_LEVEL_CAPPING,be.default.MEDIA_ATTACHING,be.default.MANIFEST_PARSED,be.default.BUFFER_CODECS,be.default.MEDIA_DETACHING)||this,r.autoLevelCapping=Number.POSITIVE_INFINITY,r.firstLevel=null,r.levels=[],r.media=null,r.restrictedLevels=[],r.timer=null,r}se(t,e);var r=t.prototype;return r.destroy=function e(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.stopCapping())},r.onFpsDropLevelCapping=function e(r){t.isLevelAllowed(r.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(r.droppedLevel)},r.onMediaAttaching=function e(t){this.media=t.media instanceof window.HTMLVideoElement?t.media:null},r.onManifestParsed=function e(t){var r=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},r.onBufferCodecs=function e(t){var r=this.hls;r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},r.onLevelsUpdated=function e(t){this.levels=t.levels},r.onMediaDetaching=function e(){this.stopCapping()},r.detectPlayerSize=function e(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var r=this.hls;r.autoLevelCapping=this.getMaxLevel(t-1),r.autoLevelCapping>this.autoLevelCapping&&r.streamController.nextLevelSwitch(),this.autoLevelCapping=r.autoLevelCapping}}},r.getMaxLevel=function e(r){var i=this;if(!this.levels)return-1;var a=this.levels.filter(function(e,a){return t.isLevelAllowed(a,i.restrictedLevels)&&a<=r});return t.getMaxLevelByMediaSize(a,this.mediaWidth,this.mediaHeight)},r.startCapping=function e(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},r.stopCapping=function e(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},t.isLevelAllowed=function e(t,r){return void 0===r&&(r=[]),-1===r.indexOf(t)},t.getMaxLevelByMediaSize=function e(t,r,i){if(!t||t&&!t.length)return-1;for(var a=function e(t,r){return!r||(t.width!==r.width||t.height!==r.height)},n=t.length-1,s=0;s<t.length;s+=1){var o=t[s];if((o.width>=r||o.height>=i)&&a(o,t[s+1])){n=s;break}}return n},ne(t,[{key:"mediaWidth",get:function e(){var r,i=this.media;return i&&(r=i.width||i.clientWidth||i.offsetWidth,r*=t.contentScaleFactor),r}},{key:"mediaHeight",get:function e(){var r,i=this.media;return i&&(r=i.height||i.clientHeight||i.offsetHeight,r*=t.contentScaleFactor),r}}],[{key:"contentScaleFactor",get:function e(){var t=1;try{t=window.devicePixelRatio}catch(r){}return t}}]),t}(_e),Yt=Wt,zt=window,Xt=zt.performance,qt=function(e){function t(t){return e.call(this,t,be.default.MEDIA_ATTACHING)||this}oe(t,e);var r=t.prototype;return r.destroy=function e(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},r.onMediaAttaching=function e(t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=this.video=t.media instanceof window.HTMLVideoElement?t.media:null;"function"==typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},r.checkFPS=function e(t,r,i){var a=Xt.now();if(r){if(this.lastTime){var n=a-this.lastTime,s=i-this.lastDroppedFrames,o=r-this.lastDecodedFrames,l=1e3*s/n,d=this.hls;if(d.trigger(be.default.FPS_DROP,{currentDropped:s,currentDecoded:o,totalDroppedFrames:i}),l>0&&s>d.config.fpsDroppedMonitoringThreshold*o){var u=d.currentLevel;Te.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===d.autoLevelCapping||d.autoLevelCapping>=u)&&(u-=1,d.trigger(be.default.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:d.currentLevel}),d.autoLevelCapping=u,d.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=i,this.lastDecodedFrames=r}},r.checkFPSInterval=function e(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var r=t.getVideoPlaybackQuality();this.checkFPS(t,r.totalVideoFrames,r.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},t}(_e),Qt=qt,Jt=window,Zt=Jt.performance,$t=Jt.XMLHttpRequest,er=function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var t=e.prototype;return t.destroy=function e(){this.abort(),this.loader=null},t.abort=function e(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.load=function e(t,r,i){this.context=t,this.config=r,this.callbacks=i,this.stats={trequest:Zt.now(),retry:0},this.retryDelay=r.retryDelay,this.loadInternal()},t.loadInternal=function e(){var t,r=this.context;t=this.loader=new $t;var i=this.stats;i.tfirst=0,i.loaded=0;var a=this.xhrSetup;try{if(a)try{a(t,r.url)}catch(n){t.open("GET",r.url,!0),a(t,r.url)}t.readyState||t.open("GET",r.url,!0)}catch(n){return void this.callbacks.onError({code:t.status,text:n.message},r,t)}r.rangeEnd&&t.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=r.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},t.readystatechange=function e(t){var r=t.currentTarget,i=r.readyState,a=this.stats,n=this.context,s=this.config;if(!a.aborted&&i>=2)if(window.clearTimeout(this.requestTimeout),0===a.tfirst&&(a.tfirst=Math.max(Zt.now(),a.trequest)),4===i){var o=r.status;if(o>=200&&o<300){var l,d;a.tload=Math.max(a.tfirst,Zt.now()),"arraybuffer"===n.responseType?(l=r.response,d=l.byteLength):(l=r.responseText,d=l.length),a.loaded=a.total=d;var u={url:r.responseURL,data:l};this.callbacks.onSuccess(u,a,n,r)}else a.retry>=s.maxRetry||o>=400&&o<499?(Te.logger.error(o+" while loading "+n.url),this.callbacks.onError({code:o,text:r.statusText},n,r)):(Te.logger.warn(o+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),a.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)},t.loadtimeout=function e(){Te.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.loadprogress=function e(t){var r=t.currentTarget,i=this.stats;i.loaded=t.loaded,t.lengthComputable&&(i.total=t.total);var a=this.callbacks.onProgress;a&&a(i,this.context,null,r)},e}(),tr=er,rr=r("./src/empty.js"),ir;!function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready"}(ir||(ir={}));var ar="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null,nr=le({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:tr,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:jt,bufferController:Vt,capLevelController:Yt,fpsController:Qt,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:ar},{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0});r.d(t,"default",function(){return sr});var sr=function(e){function t(r){var i;void 0===r&&(r={}),i=e.call(this)||this,i.config=void 0,i._autoLevelCapping=void 0,i.abrController=void 0,i.capLevelController=void 0,i.levelController=void 0,i.streamController=void 0,i.networkControllers=void 0,i.audioTrackController=void 0,i.subtitleTrackController=void 0,i.emeController=void 0,i.coreComponents=void 0,i.media=null,i.url=null;var a=t.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");i.config=fe({},a,r);var n=he(i),s=n.config;if(void 0!==s.liveMaxLatencyDurationCount&&s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==s.liveMaxLatencyDuration&&(void 0===s.liveSyncDuration||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(Te.enableLogs)(s.debug),i._autoLevelCapping=-1;var o=i.abrController=new s.abrController(he(i)),l=new s.bufferController(he(i)),d=i.capLevelController=new s.capLevelController(he(i)),u=new s.fpsController(he(i)),f=new Ye(he(i)),c=new Xe(he(i)),h=new Qe(he(i)),g=new Pt(he(i)),v=i.levelController=new It(he(i)),p=new tt(he(i)),m=i.streamController=new Lt(he(i),p),y=[v,m],E=s.audioStreamController;E&&y.push(new E(he(i),p)),i.networkControllers=y;var b=[f,c,h,o,l,d,u,g,p];if(E=s.audioTrackController,E){var T=new E(he(i));i.audioTrackController=T,b.push(T)}if(E=s.subtitleTrackController,E){var S=new E(he(i));i.subtitleTrackController=S,y.push(S)}if(E=s.emeController,E){var A=new E(he(i));i.emeController=A,b.push(A)}return E=s.subtitleStreamController,E&&y.push(new E(he(i),p)),E=s.timelineController,E&&b.push(new E(he(i))),i.coreComponents=b,i}pe(t,e),t.isSupported=function e(){return Z()},ve(t,null,[{key:"version",get:function e(){return"0.13.1"}},{key:"Events",get:function e(){return be.default}},{key:"ErrorTypes",get:function e(){return ye.ErrorTypes}},{key:"ErrorDetails",get:function e(){return ye.ErrorDetails}},{key:"DefaultConfig",get:function e(){return t.defaultConfig?t.defaultConfig:nr},set:function e(r){t.defaultConfig=r}}]);var r=t.prototype;return r.destroy=function e(){Te.logger.log("destroy"),this.trigger(be.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},r.attachMedia=function e(t){Te.logger.log("attachMedia"),this.media=t,this.trigger(be.default.MEDIA_ATTACHING,{media:t})},r.detachMedia=function e(){Te.logger.log("detachMedia"),this.trigger(be.default.MEDIA_DETACHING),this.media=null},r.loadSource=function e(t){t=me.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),Te.logger.log("loadSource:"+t),this.url=t,this.trigger(be.default.MANIFEST_LOADING,{url:t})},r.startLoad=function e(t){void 0===t&&(t=-1),Te.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})},r.stopLoad=function e(){Te.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},r.swapAudioCodec=function e(){Te.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},r.recoverMediaError=function e(){Te.logger.log("recoverMediaError");var t=this.media;this.detachMedia(),t&&this.attachMedia(t)},ve(t,[{key:"levels",get:function e(){return this.levelController.levels}},{key:"currentLevel",get:function e(){return this.streamController.currentLevel},set:function e(t){Te.logger.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function e(){return this.streamController.nextLevel},set:function e(t){Te.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function e(){return this.levelController.level},set:function e(t){Te.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function e(){return this.levelController.nextLoadLevel},set:function e(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function e(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function e(t){Te.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function e(){return this.levelController.startLevel},set:function e(t){Te.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",set:function e(t){var r=!!t;r!==this.config.capLevelToPlayerSize&&(r?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=r)}},{key:"autoLevelCapping",get:function e(){return this._autoLevelCapping},set:function e(t){Te.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"bandwidthEstimate",get:function e(){var t=this.abrController._bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function e(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function e(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function e(){for(var t=this.levels,r=this.config.minAutoBitrate,i=t?t.length:0,a=0;a<i;a++){var n=t[a].realBitrate?Math.max(t[a].realBitrate,t[a].bitrate):t[a].bitrate;if(n>r)return a}return 0}},{key:"maxAutoLevel",get:function e(){var t=this.levels,r=this.autoLevelCapping,i;return i=-1===r&&t&&t.length?t.length-1:r,i}},{key:"nextAutoLevel",get:function e(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function e(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function e(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function e(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function e(t){var r=this.audioTrackController;r&&(r.audioTrack=t)}},{key:"liveSyncPosition",get:function e(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function e(t){var r=this.subtitleTrackController;r&&(r.subtitleTrack=t)}},{key:"subtitleDisplay",get:function e(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function e(t){var r=this.subtitleTrackController;r&&(r.subtitleDisplay=t)}}]),t}(dt);sr.defaultConfig=void 0},"./src/polyfills/number-isFinite.js":
/*!******************************************!*\
  !*** ./src/polyfills/number-isFinite.js ***!
  \******************************************/
/*! exports provided: isFiniteNumber */function(e,t,r){"use strict";r.r(t),r.d(t,"isFiniteNumber",function(){return i});var i=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)}},"./src/utils/get-self-scope.js":
/*!*************************************!*\
  !*** ./src/utils/get-self-scope.js ***!
  \*************************************/
/*! exports provided: getSelfScope */function(e,t,r){"use strict";function i(){return"undefined"==typeof window?self:window}r.r(t),r.d(t,"getSelfScope",function(){return i})},"./src/utils/logger.js":
/*!*****************************!*\
  !*** ./src/utils/logger.js ***!
  \*****************************/
/*! exports provided: enableLogs, logger */function(e,t,r){"use strict";function i(){}function a(e,t){return t="["+e+"] > "+t,t}function n(e){var t=u.console[e];return t?function(){for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];i[0]&&(i[0]=a(e,i[0])),t.apply(u.console,i)}:i}function s(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(t){d[t]=e[t]?e[t].bind(e):n(t)})}r.r(t),r.d(t,"enableLogs",function(){return f}),r.d(t,"logger",function(){return c});var o=r(/*! ./get-self-scope */"./src/utils/get-self-scope.js"),l={trace:i,debug:i,log:i,warn:i,info:i,error:i},d=l,u=Object(o.getSelfScope)(),f=function e(t){if(u.console&&!0===t||"object"==typeof t){s(t,"debug","log","info","warn","error");try{d.log()}catch(r){d=l}}else d=l},c=d}}).default})}}]);